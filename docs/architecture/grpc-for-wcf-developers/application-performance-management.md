---
title: 'Anwendungs Leistungsverwaltung: GrpC für WCF-Entwickler'
description: Protokollierung, Metriken und Ablauf Verfolgung für ASP.net Core GrpC-Anwendungen.
author: markrendle
ms.date: 09/02/2019
ms.openlocfilehash: 6ba67fd069e7efc232f912e50c0e283facb79e9c
ms.sourcegitcommit: 337bdc5a463875daf2cc6883e5a2da97d56f5000
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/24/2019
ms.locfileid: "73841684"
---
# <a name="application-performance-management"></a><span data-ttu-id="4fe92-103">Application Performance Management</span><span class="sxs-lookup"><span data-stu-id="4fe92-103">Application Performance Management</span></span>

<span data-ttu-id="4fe92-104">In modernen Produktionsumgebungen wie Kubernetes ist es sehr wichtig, dass Sie Anwendungen überwachen können, um sicherzustellen, dass Sie optimal ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-104">In modern production environments like Kubernetes, it's very important to be able to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="4fe92-105">Probleme wie Protokollierung und Metriken waren nie wichtiger.</span><span class="sxs-lookup"><span data-stu-id="4fe92-105">Concerns like logging and metrics have never been more important.</span></span> <span data-ttu-id="4fe92-106">ASP.net Core, einschließlich GrpC, bietet erstklassige Unterstützung für das Erstellen und Verwalten von Protokollnachrichten und Metrikdaten sowie die Ablauf *Verfolgung* von Daten.</span><span class="sxs-lookup"><span data-stu-id="4fe92-106">ASP.NET Core, including gRPC, has first-class support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span> <span data-ttu-id="4fe92-107">In diesem Abschnitt werden diese Bereiche ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="4fe92-107">This section will explore these areas in more details.</span></span>

## <a name="logging-vs-metrics"></a><span data-ttu-id="4fe92-108">Protokollierung und Metriken</span><span class="sxs-lookup"><span data-stu-id="4fe92-108">Logging vs Metrics</span></span>

<span data-ttu-id="4fe92-109">Vor der Betrachtung der Implementierungsdetails ist es erforderlich, den Unterschied zwischen Protokollierung und Metriken zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-109">Before looking at the implementation details, it's necessary to understand the difference between logging and metrics.</span></span>

<span data-ttu-id="4fe92-110">Bei der Protokollierung werden Textnachrichten behandelt, in denen ausführliche Informationen zu den Vorgängen im System aufgezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-110">Logging is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="4fe92-111">Protokollmeldungen können Ausnahme Daten wie Stapel Überwachungen oder strukturierte Daten enthalten, die den Kontext der Nachricht bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-111">Log messages may include exception data like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="4fe92-112">Die Protokollierungs Ausgabe wird häufig in einen durchsuchbaren Text Speicher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="4fe92-112">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="4fe92-113">Metriken beziehen sich auf numerische Daten, die für die Zusammenfassung und Darstellung mithilfe von Diagrammen und Diagrammen in einem Dashboard entwickelt wurden, das eine Übersicht über die allgemeine Integrität und Leistung einer Anwendung bietet.</span><span class="sxs-lookup"><span data-stu-id="4fe92-113">Metrics refers to numeric data that is designed to be aggregated and presented using charts and graphs in a dashboard that provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="4fe92-114">Metrikdaten können auch verwendet werden, um automatisierte Warnungen zu initiieren, wenn ein Schwellenwert überschritten wird.</span><span class="sxs-lookup"><span data-stu-id="4fe92-114">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="4fe92-115">Die folgende Liste zeigt einige Beispiele für Metrikdaten:</span><span class="sxs-lookup"><span data-stu-id="4fe92-115">The following list shows some examples of metrics data:</span></span>

- <span data-ttu-id="4fe92-116">Benötigte Zeit für die Verarbeitung von Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-116">Time taken to process requests.</span></span>
- <span data-ttu-id="4fe92-117">Die Anzahl der Anforderungen pro Sekunde, die von einer Instanz eines Dienstanbieter verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-117">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="4fe92-118">Die Anzahl der fehlerhaften Anforderungen auf einer-Instanz.</span><span class="sxs-lookup"><span data-stu-id="4fe92-118">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="4fe92-119">Anmelden ASP.net Core GrpC</span><span class="sxs-lookup"><span data-stu-id="4fe92-119">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="4fe92-120">ASP.net Core bietet integrierte Unterstützung für die Protokollierung in Form des [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) -nuget-Pakets.</span><span class="sxs-lookup"><span data-stu-id="4fe92-120">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="4fe92-121">Die Kernteile dieser Bibliothek sind im Web-SDK enthalten, sodass es nicht erforderlich ist, es manuell zu installieren.</span><span class="sxs-lookup"><span data-stu-id="4fe92-121">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="4fe92-122">Standardmäßig werden Protokollmeldungen in die Standardausgabe ("Console") und in einen beliebigen angefügten Debugger geschrieben.</span><span class="sxs-lookup"><span data-stu-id="4fe92-122">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="4fe92-123">Wenn Sie Protokolle in persistente externe Datenspeicher schreiben möchten, müssen Sie möglicherweise [optionale Protokollierungs-senkenpakete](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers)importieren.</span><span class="sxs-lookup"><span data-stu-id="4fe92-123">To write logs to persistent external data stores, you may need to import [optional logging sink packages](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="4fe92-124">Das ASP.net Core GrpC-Framework schreibt ausführliche Diagnose Protokollierungs Meldungen in dieses Protokollierungs Framework, damit Sie zusammen mit den eigenen Nachrichten Ihrer Anwendung verarbeitet/gespeichert werden können.</span><span class="sxs-lookup"><span data-stu-id="4fe92-124">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework so they can be processed/stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="4fe92-125">Protokollmeldungen werden erzeugt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-125">Produce log messages</span></span>

<span data-ttu-id="4fe92-126">Die Protokollierungs Erweiterung wird automatisch im Abhängigkeits Injektionssystem von ASP.net Core registriert, sodass Sie Protokollierungen als Konstruktorparameter für GrpC-Dienst Typen angeben können.</span><span class="sxs-lookup"><span data-stu-id="4fe92-126">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="4fe92-127">Viele Protokollmeldungen zu Anforderungen, Ausnahmen usw. werden von den ASP.net Core-und GrpC-Framework-Komponenten bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-127">Many log messages around requests, exceptions, and so on, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="4fe92-128">Fügen Sie eigene Protokollnachrichten hinzu, um Details und Kontext zur Anwendungslogik bereitzustellen, anstatt Probleme auf niedrigerer Ebene zu bieten.</span><span class="sxs-lookup"><span data-stu-id="4fe92-128">Add your own log messages to provide detail and context about application logic rather than lower-level concerns.</span></span>

<span data-ttu-id="4fe92-129">Weitere Informationen zum Schreiben von Protokollmeldungen und verfügbaren Protokollierungs senken und-Zielen finden Sie im Artikel [Protokollierung in .net Core und ASP.net Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) .</span><span class="sxs-lookup"><span data-stu-id="4fe92-129">For more information about writing log messages and available logging sinks and targets, see the [Logging in .NET Core and ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) article.</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="4fe92-130">Metriken in ASP.net Core GrpC</span><span class="sxs-lookup"><span data-stu-id="4fe92-130">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="4fe92-131">Die .net Core-Laufzeit stellt eine Reihe von Komponenten zum ausgeben und beobachten von Metriken bereit, die APIs enthalten, wie z. b. die Klassen <xref:System.Diagnostics.Tracing.EventSource> und <xref:System.Diagnostics.Tracing.EventCounter>.</span><span class="sxs-lookup"><span data-stu-id="4fe92-131">The .NET Core runtime provides a set of components for emitting and observing metrics that includes APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="4fe92-132">Diese APIs können verwendet werden, um grundlegende numerische Daten auszugeben, die von externen Prozessen wie dem [globalen dotnet-Counters-Tool](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md)oder der Ereignis Ablauf Verfolgung für Windows genutzt werden können.</span><span class="sxs-lookup"><span data-stu-id="4fe92-132">These APIs can be used to emit basic numeric data that can be consumed by external processes like the [dotnet-counters global tool](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="4fe92-133">Weitere Informationen zum Verwenden von `EventCounter` in Ihrem eigenen Code finden Sie im [Event Counter Introduction](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) -Tutorial.</span><span class="sxs-lookup"><span data-stu-id="4fe92-133">For more information about using `EventCounter` in your own code, see the [EventCounter Introduction](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) tutorial.</span></span>

<span data-ttu-id="4fe92-134">Für erweiterte Metriken und zum Schreiben von Metrikdaten in eine größere Anzahl von Daten speichern gibt es ein hervorragendes Open Source-Projekt mit dem Namen [App-Metriken](https://www.app-metrics.io).</span><span class="sxs-lookup"><span data-stu-id="4fe92-134">For more advanced metrics and for writing metric data to a wider range of data stores, there's an excellent open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="4fe92-135">Diese Sammlung von Bibliotheken bietet einen umfangreichen Satz von Typen, um Ihren Code zu instrumentieren.</span><span class="sxs-lookup"><span data-stu-id="4fe92-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="4fe92-136">Außerdem werden Pakete zum Schreiben von Metriken in verschiedene Arten von Zielen angeboten, die Zeitreihen Datenbanken wie z. b. Prometheus und Einfluss xdb, [Azure-Anwendung Einblicke](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview)und vieles mehr enthalten.</span><span class="sxs-lookup"><span data-stu-id="4fe92-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview), and more.</span></span> <span data-ttu-id="4fe92-137">Das nuget-Paket [app. Metrics. aspnetcore. MVC](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) fügt sogar einen umfassenden Satz grundlegender Metriken hinzu, die automatisch über die Integration in das ASP.net Core Framework generiert werden. die Website stellt [Vorlagen](https://www.app-metrics.io/samples/grafana/) zum Anzeigen dieser Metriken mit der [grafana](https://grafana.com/) -Visualisierungsplattform bereit.</span><span class="sxs-lookup"><span data-stu-id="4fe92-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework, and the web site provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

<span data-ttu-id="4fe92-138">Weitere Informationen und Dokumentation zu app-Metriken finden Sie auf der [App-Metrics.IO](https://app-metrics.io) -Website.</span><span class="sxs-lookup"><span data-stu-id="4fe92-138">For more information and documentation about App Metrics, see the [app-metrics.io](https://app-metrics.io) website.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="4fe92-139">Metriken</span><span class="sxs-lookup"><span data-stu-id="4fe92-139">Produce metrics</span></span>

<span data-ttu-id="4fe92-140">Die meisten metrikplattformen unterstützen fünf Grundtypen von Metriken, die in der folgenden Tabelle aufgeführt sind:</span><span class="sxs-lookup"><span data-stu-id="4fe92-140">Most metrics platforms support five basic types of metric, outlined in the following table:</span></span>

| <span data-ttu-id="4fe92-141">Metriktyp</span><span class="sxs-lookup"><span data-stu-id="4fe92-141">Metric type</span></span> | <span data-ttu-id="4fe92-142">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="4fe92-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="4fe92-143">Zähler</span><span class="sxs-lookup"><span data-stu-id="4fe92-143">Counter</span></span>     | <span data-ttu-id="4fe92-144">Verfolgt, wie oft etwas passiert, z. b. Anforderungen, Fehler usw.</span><span class="sxs-lookup"><span data-stu-id="4fe92-144">Tracks how often something happens, such as requests, errors, and so on.</span></span> |
| <span data-ttu-id="4fe92-145">Mess Gerät</span><span class="sxs-lookup"><span data-stu-id="4fe92-145">Gauge</span></span>       | <span data-ttu-id="4fe92-146">Zeichnet einen einzelnen Wert auf, der sich im Laufe der Zeit ändert, beispielsweise aktive Verbindungen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="4fe92-147">Histogramm</span><span class="sxs-lookup"><span data-stu-id="4fe92-147">Histogram</span></span>   | <span data-ttu-id="4fe92-148">Misst eine Verteilung von Werten über beliebige Grenzen hinweg.</span><span class="sxs-lookup"><span data-stu-id="4fe92-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="4fe92-149">Ein Histogramm könnte z. b. die Größe des Datasets verfolgen und zählen, wie viele < 10 Datensätze enthalten sind, wie viele 11-100 und 101-1000, und > 1000 Datensätze.</span><span class="sxs-lookup"><span data-stu-id="4fe92-149">For example, a histogram could track data set size, counting how many contained <10 records, how many 11-100 and 101-1000, and >1000 records.</span></span> |
| <span data-ttu-id="4fe92-150">Messen</span><span class="sxs-lookup"><span data-stu-id="4fe92-150">Meter</span></span>       | <span data-ttu-id="4fe92-151">Misst die Rate, mit der ein Ereignis in verschiedenen Zeitspannen auftritt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="4fe92-152">Zeitgeber</span><span class="sxs-lookup"><span data-stu-id="4fe92-152">Timer</span></span>       | <span data-ttu-id="4fe92-153">Verfolgt die Dauer der Ereignisse und die Rate, mit der es eintritt, als Histogramm gespeichert.</span><span class="sxs-lookup"><span data-stu-id="4fe92-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="4fe92-154">Mithilfe von *App-Metriken*kann eine `IMetrics` Schnittstelle über die Abhängigkeitsinjektion abgerufen und zum Aufzeichnen dieser Metriken für einen GrpC-Dienst verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-154">Using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="4fe92-155">Im folgenden Beispiel wird gezeigt, wie die Anzahl von `Get` Anforderungen gezählt wird, die im Laufe der Zeit ausgeführt wurden:</span><span class="sxs-lookup"><span data-stu-id="4fe92-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="4fe92-156">Speichern und Visualisieren von Metrikdaten</span><span class="sxs-lookup"><span data-stu-id="4fe92-156">Store and visualize metrics data</span></span>

<span data-ttu-id="4fe92-157">Die beste Möglichkeit zum Speichern von Metrikdaten befindet sich in einer *Zeitreihen Datenbank*, einem speziellen Datenspeicher, der für die Aufzeichnung numerischer Datenreihen konzipiert ist, die mit Zeitstempeln markiert sind.</span><span class="sxs-lookup"><span data-stu-id="4fe92-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="4fe92-158">Die beliebtesten dieser Datenbanken sind [Prometheus](https://prometheus.io/) und [Einfluss xdb](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="4fe92-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="4fe92-159">Microsoft Azure bietet auch dedizierten metrikspeicher über den [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) -Dienst.</span><span class="sxs-lookup"><span data-stu-id="4fe92-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="4fe92-160">Die aktuelle Lösung für die Visualisierung von Metrikdaten ist " [grafana](https://grafana.com)", die mit einer Vielzahl von Speicheranbietern wie Azure Monitor, Einfluss xdb und Prometheus funktioniert.</span><span class="sxs-lookup"><span data-stu-id="4fe92-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers including Azure Monitor, InfluxDB and Prometheus.</span></span> <span data-ttu-id="4fe92-161">Die folgende Abbildung zeigt ein Beispiel für ein grafana-Dashboard, das Metriken aus dem linkerd-dienstmesh anzeigt, das das StockData-Beispiel enthält:</span><span class="sxs-lookup"><span data-stu-id="4fe92-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Grafana-Dashboard](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="4fe92-163">Metrikbasierte Warnungen</span><span class="sxs-lookup"><span data-stu-id="4fe92-163">Metrics-based alerting</span></span>

<span data-ttu-id="4fe92-164">Die numerische Natur von Metrikdaten bedeutet, dass Sie idealerweise für Warnsysteme geeignet ist, die Entwickler oder Support Techniker Benachrichtigen, wenn ein Wert außerhalb der definierten Toleranz liegt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="4fe92-165">Die bereits erwähnten Plattformen bieten Unterstützung für Warnungen über eine Reihe von Optionen, einschließlich e-Mails, Textnachrichten oder Dashboards in Dashboards.</span><span class="sxs-lookup"><span data-stu-id="4fe92-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="4fe92-166">Verteilte Ablauf Verfolgung</span><span class="sxs-lookup"><span data-stu-id="4fe92-166">Distributed tracing</span></span>

<span data-ttu-id="4fe92-167">Die *verteilte Ablauf Verfolgung* ist eine relativ aktuelle Entwicklung in der Überwachung, die aus der zunehmenden Verwendung von microservices und verteilten Architekturen entstanden ist.</span><span class="sxs-lookup"><span data-stu-id="4fe92-167">*Distributed tracing* is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="4fe92-168">Eine einzelne Anforderung von einem Client Browser, einer Anwendung oder einem Gerät kann in viele Schritte und untergeordnete Anforderungen aufgeteilt werden und umfasst die Verwendung vieler Dienste in einem Netzwerk.</span><span class="sxs-lookup"><span data-stu-id="4fe92-168">A single request from a client browser, application, or device may be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="4fe92-169">Dadurch wird es schwierig, Protokollmeldungen und Metriken mit der jeweiligen Anforderung zu korrelieren, durch die Sie ausgelöst wurden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="4fe92-170">Die verteilte Ablauf Verfolgung wendet Bezeichner auf Anforderungen an, die das korrelieren von Protokollen und Metriken mit einem bestimmten Vorgang ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-170">Distributed tracing applies identifiers to requests that allow logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="4fe92-171">Dies ist vergleichbar mit [der End-to-End-Ablauf Verfolgung von WCF](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), wird jedoch auf mehrere Plattformen angewendet.</span><span class="sxs-lookup"><span data-stu-id="4fe92-171">This is similar to [WCF's end-to-end tracing](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), but applied across multiple platforms.</span></span>

<span data-ttu-id="4fe92-172">Obwohl es sich immer noch um einen bereits laufenden Technologiebereich handelt, wurde die verteilte Ablauf Verfolgung schnell und durch einen Standardisierungsprozess erweitert.</span><span class="sxs-lookup"><span data-stu-id="4fe92-172">Although it's still a nascent technology area, distributed tracing has grown quickly in popularity and is now going through a standardization process.</span></span> <span data-ttu-id="4fe92-173">Die Cloud Native Computing Foundation erstellte den [offenen Ablauf Verfolgungs Standard](https://opentracing.io)und versuchte, Anbieter neutrale Bibliotheken für das Arbeiten mit Back-Ends wie z. b. [Jaeger](https://www.jaegertracing.io/) und [elastisches apm](https://www.elastic.co/products/apm)bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-173">The Cloud Native Computing Foundation created the [the Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with backends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="4fe92-174">Gleichzeitig hat Google das [opencensus-Projekt](https://opencensus.io/) erstellt, um die gleichen Probleme zu beheben.</span><span class="sxs-lookup"><span data-stu-id="4fe92-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="4fe92-175">Diese beiden Projekte werden nun in einem neuen Projekt ( [opentelemetry](https://opentelemetry.io)) zusammengeführt, das als zukünftiger Industriestandard dienen soll.</span><span class="sxs-lookup"><span data-stu-id="4fe92-175">These two projects are now being merged into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the future industry standard.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="4fe92-176">Funktionsweise der verteilten Ablauf Verfolgung</span><span class="sxs-lookup"><span data-stu-id="4fe92-176">How distributed tracing works</span></span>

<span data-ttu-id="4fe92-177">Die verteilte Ablauf Verfolgung basiert auf dem Konzept der *Spannen*: benannte, zeitgesteuerte *Vorgänge, die Teil einer einzelnen Ablauf*Verfolgung sind, die möglicherweise die Verarbeitung auf mehreren Knoten eines Systems einschließt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-177">Distributed tracing is based on the concept of *Spans*: named, timed operations that are part of a single *Trace*, which may involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="4fe92-178">Wenn ein neuer Vorgang initiiert wird, wird eine Ablauf Verfolgung mit einem eindeutigen Bezeichner erstellt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="4fe92-179">Für jeden unter Vorgang wird eine Spanne mit eigenem Bezeichner und Ablauf Verfolgungs Bezeichner erstellt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="4fe92-180">Wenn die Anforderung das System durchläuft, können verschiedene Komponenten untergeordnete *Spannen erstellen* , die den Bezeichner des über *geordneten*Elements enthalten.</span><span class="sxs-lookup"><span data-stu-id="4fe92-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="4fe92-181">Eine Spanne verfügt über einen *Kontext*, der die Ablaufverfolgungs-und Span-IDs sowie nützliche Daten in Form von Schlüssel-Wert-Paaren (als *Gepäck*bezeichnet) enthält.</span><span class="sxs-lookup"><span data-stu-id="4fe92-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key/value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="4fe92-182">Verteilte Ablauf Verfolgung mit diagnosticsource</span><span class="sxs-lookup"><span data-stu-id="4fe92-182">Distributed tracing with DiagnosticSource</span></span>

<span data-ttu-id="4fe92-183">.Net Core verfügt über ein internes Modul, das sich gut für verteilte Ablauf Verfolgungen und spannen zuordnet: [diagnosticsource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="4fe92-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="4fe92-184">Und eine einfache Möglichkeit zum erzeugen und Nutzen von Diagnosen innerhalb eines Prozesses bietet das `DiagnosticSource` Modul das Konzept einer *Aktivität*, bei der es sich um eine Implementierung einer verteilten Ablauf Verfolgung oder eine Spanne innerhalb einer Ablauf Verfolgung handelt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *Activity*, which is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="4fe92-185">Die internale des Moduls kümmern sich um über-und untergeordnete Aktivitäten, einschließlich der Zuordnung von bezeichtern.</span><span class="sxs-lookup"><span data-stu-id="4fe92-185">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="4fe92-186">Weitere Informationen zur Verwendung des `Activity` Typs finden Sie im [Benutzerhandbuch für Aktivitäten auf GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide) .</span><span class="sxs-lookup"><span data-stu-id="4fe92-186">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span></span>

<span data-ttu-id="4fe92-187">Da diagnosticsource Teil des Kern-Frameworks ist, wird es von mehreren Kernkomponenten unterstützt, einschließlich <xref:System.Net.Http.HttpClient>, Entity Framework Core und ASP.net Core, einschließlich expliziter Unterstützung im GrpC-Framework.</span><span class="sxs-lookup"><span data-stu-id="4fe92-187">Because DiagnosticSource is a part of the core framework, it's supported by several core components, including <xref:System.Net.Http.HttpClient>, Entity Framework Core and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="4fe92-188">Wenn ASP.net Core eine Anforderung empfängt, überprüft er, ob ein paar von HTTP-Headern mit dem W3C-Ablauf [Verfolgungs Kontext](https://www.w3.org/TR/trace-context) Standard übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-188">When ASP.NET Core receives a request, it  checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="4fe92-189">Wenn die Header gefunden werden, wird eine Aktivität mithilfe der Identitäts Werte und des Kontexts aus den Headern gestartet.</span><span class="sxs-lookup"><span data-stu-id="4fe92-189">If the headers are found, an Activity is started using the identity values and context from the headers.</span></span> <span data-ttu-id="4fe92-190">Wenn keine Header gefunden werden, wird eine Aktivität mit generierten Identitäts Werten gestartet, die dem Standardformat entsprechen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-190">If no headers are found, an Activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="4fe92-191">Alle Diagnosen, die während der Lebensdauer dieser Aktivität vom Framework oder Anwendungscode generiert werden, können mit der Ablauf Verfolgung und den spannen Bezeichner gekennzeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-191">Any diagnostics generated by the framework or by application code during the lifetime of this Activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="4fe92-192">Die `HttpClient`-Unterstützung erweitert dies, indem bei jeder Anforderung eine aktuelle Aktivität überprüft und der ausgehenden Anforderung automatisch die Ablauf Verfolgungs Header hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-192">The `HttpClient` support extends this further by checking for a current Activity on every request and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="4fe92-193">Die ASP.net Core GrpC-Client und-Server Bibliotheken umfassen explizite Unterstützung für diagnosticsource und Activity und erstellen Aktivitäten und wenden Header Informationen automatisch an und verwenden Sie.</span><span class="sxs-lookup"><span data-stu-id="4fe92-193">The ASP.NET Core gRPC client and server libraries include explicit support for DiagnosticSource and Activity, and will create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="4fe92-194">All dies geschieht nur, wenn ein *Listener* die Diagnoseinformationen nutzt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-194">All of this only happens if a *listener* is consuming the diagnostic information.</span></span> <span data-ttu-id="4fe92-195">Wenn kein Listener vorhanden ist, werden keine Diagnosen geschrieben, und es werden keine Aktivitäten erstellt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-195">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsources-and-activities"></a><span data-ttu-id="4fe92-196">Hinzufügen eigener diagnosticsources-und-Aktivitäten</span><span class="sxs-lookup"><span data-stu-id="4fe92-196">Add your own DiagnosticSources and Activities</span></span>

<span data-ttu-id="4fe92-197">Obwohl eine gute Menge von Daten automatisch durch ASP.net Core generiert wird, einschließlich GrpC sowie Entity Framework Core und `HttpClient`, können Sie Ihre eigene Diagnose hinzufügen oder explizite Spannen innerhalb Ihres Anwendungs Codes erstellen.</span><span class="sxs-lookup"><span data-stu-id="4fe92-197">Although a good quantity of data is automatically generated by ASP.NET Core, including gRPC, as well as Entity Framework Core and `HttpClient`, you may wish to add your own diagnostics or create explicit spans within your application code.</span></span> <span data-ttu-id="4fe92-198">Ausführliche Informationen zum Implementieren ihrer eigenen Diagnose finden Sie im [Benutzerhandbuch zu diagnosticsource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) und [Aktivitäts Benutzerhandbuch](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) .</span><span class="sxs-lookup"><span data-stu-id="4fe92-198">Refer to the [DiagnosticSource User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) for details on how to implement your own diagnostics.</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="4fe92-199">Speichern verteilter Ablauf Verfolgungs Daten</span><span class="sxs-lookup"><span data-stu-id="4fe92-199">Store distributed trace data</span></span>

<span data-ttu-id="4fe92-200">Zum Zeitpunkt der Erstellung des Projekts "opentelemetry" befindet sich noch in den frühen Phasen, und für .NET-Anwendungen sind nur Alpha-Qualitäts Pakete verfügbar.</span><span class="sxs-lookup"><span data-stu-id="4fe92-200">At the time of writing the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="4fe92-201">Das opentracing-Projekt bietet ausgereifte Bibliotheken, die jedoch in Zukunft durch die opentelemetry-Bibliotheken abgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="4fe92-201">The OpenTracing project offers more mature libraries, but these will be superseded by the OpenTelemetry libraries in the future.</span></span>

<span data-ttu-id="4fe92-202">Die opentracing-API wird unten beschrieben.</span><span class="sxs-lookup"><span data-stu-id="4fe92-202">The OpenTracing API is described below.</span></span> <span data-ttu-id="4fe92-203">Wenn Sie die neuere opentelemetry-API in Ihrer Anwendung verwenden möchten, finden Sie weitere Informationen im [opentelemetry .NET SDK-Repository auf GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span><span class="sxs-lookup"><span data-stu-id="4fe92-203">If you would prefer to use the newer OpenTelemetry API in your application, refer to the [OpenTelemetry .NET SDK repository on GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="4fe92-204">Verwenden des opentracing-Pakets zum Speichern verteilter Ablauf Verfolgungs Daten</span><span class="sxs-lookup"><span data-stu-id="4fe92-204">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="4fe92-205">[Ein opentrace-nuget-Paket](https://www.nuget.org/packages/OpenTracing/) , das alle mit opentrace kompatiblen Back-Ends unterstützt (die unabhängig von `DiagnosticSource`verwendet werden können).</span><span class="sxs-lookup"><span data-stu-id="4fe92-205">The [an OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) that supports all OpenTracing-compliant back-ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="4fe92-206">Es gibt ein zusätzliches Paket aus dem opentracing-API-Beitrags Projekt, [opentracing. contrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), das einen `DiagnosticSource` Listener hinzufügt und Ereignisse und Aktivitäten automatisch in ein Back-End schreibt.</span><span class="sxs-lookup"><span data-stu-id="4fe92-206">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), which adds a `DiagnosticSource` listener and writes events and activities to a back-end automatically.</span></span> <span data-ttu-id="4fe92-207">Das Aktivieren dieses Pakets ist so einfach wie das Installieren von nuget und das Hinzufügen als Dienst in ihrer `Startup`-Klasse.</span><span class="sxs-lookup"><span data-stu-id="4fe92-207">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="4fe92-208">Das opentracing-Paket ist eine Abstraktionsschicht und erfordert daher eine Back-End-spezifische Implementierung.</span><span class="sxs-lookup"><span data-stu-id="4fe92-208">The OpenTracing package is an abstraction layer and as such it requires a back-end-specific implementation.</span></span> <span data-ttu-id="4fe92-209">Opentrace-API-Implementierungen sind für die folgenden Open Source-Back-Ends verfügbar.</span><span class="sxs-lookup"><span data-stu-id="4fe92-209">OpenTracing API implementations are available for the following open source back-ends.</span></span>

| <span data-ttu-id="4fe92-210">-Name</span><span class="sxs-lookup"><span data-stu-id="4fe92-210">Name</span></span> | <span data-ttu-id="4fe92-211">Package</span><span class="sxs-lookup"><span data-stu-id="4fe92-211">Package</span></span> | <span data-ttu-id="4fe92-212">Website</span><span class="sxs-lookup"><span data-stu-id="4fe92-212">Web site</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="4fe92-213">Jaeger</span><span class="sxs-lookup"><span data-stu-id="4fe92-213">Jaeger</span></span> | [<span data-ttu-id="4fe92-214">Jaeger</span><span class="sxs-lookup"><span data-stu-id="4fe92-214">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="4fe92-215">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="4fe92-215">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="4fe92-216">Elastisches apm</span><span class="sxs-lookup"><span data-stu-id="4fe92-216">Elastic APM</span></span> | [<span data-ttu-id="4fe92-217">Elastisches apm. netcoreall</span><span class="sxs-lookup"><span data-stu-id="4fe92-217">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="4fe92-218">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="4fe92-218">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="4fe92-219">Weitere Informationen zur opentrace-API für .net finden Sie unter [opentracing für C# ](https://github.com/opentracing/opentracing-csharp) und [opentracing contrib C#/.net kernrepository](https://github.com/opentracing-contrib/csharp-netcore) auf GitHub.</span><span class="sxs-lookup"><span data-stu-id="4fe92-219">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="4fe92-220">[Zurück](load-balancing.md)
>[Weiter](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="4fe92-220">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
