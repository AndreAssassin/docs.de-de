---
title: Überschreiben der Identität eines Dienstes zur Authentifizierung
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: eed8a1edaae5fab03ad9e78d29803676debd1b9a
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/07/2019
ms.locfileid: "70796915"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="e8f3b-102">Überschreiben der Identität eines Dienstes zur Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="e8f3b-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="e8f3b-103">In der Regel müssen Sie die Identität für einen Dienst nicht festlegen, da die Auswahl eines Clientanmeldeinformationstyps über den in den Dienstmetadaten angezeigten Identitätstyp entscheidet.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="e8f3b-104">Der folgende Konfigurations Code verwendet beispielsweise das [ \<WSHttpBinding->](../../configure-apps/file-schema/wcf/wshttpbinding.md) -Element und legt `clientCredentialType` das-Attribut auf Windows fest.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="e8f3b-105">Das folgende Web Services Description Language (WSDL)-Fragment zeigt die Identität für den zuvor definierten Endpunkt an.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="e8f3b-106">In diesem Beispiel wird der Dienst als selbstgeh osteter Dienst unter einem bestimmten Benutzerkonto (username@contoso.com) ausgeführt. Daher enthält die Benutzer Prinzipal Namen-Identität (User Principal Name, UPN) den Kontonamen.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="e8f3b-107">Der UPN wird in einer Windows-Domäne auch als Benutzeranmeldename bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  

 <span data-ttu-id="e8f3b-108">Eine Beispielanwendung, die die Identitäts Einstellung veranschaulicht, finden Sie unter [Beispiel für Dienst Identität](../samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="e8f3b-109">Weitere Informationen zur Dienst Identität finden Sie unter [Dienst Identität und-Authentifizierung](../feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-109">For more information about service identity, see [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="e8f3b-110">Kerberos-Authentifizierung und Identität</span><span class="sxs-lookup"><span data-stu-id="e8f3b-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="e8f3b-111">Wenn ein Dienst für die Verwendung von Windows-Anmelde Informationen konfiguriert ist, wird standardmäßig ein [ \<Identity >](../../configure-apps/file-schema/wcf/identity.md) -Element verwendet, das eine [ \<userPrincipalName->](../../configure-apps/file-schema/wcf/userprincipalname.md) oder [ \<ein servicePrincipalName->](../../configure-apps/file-schema/wcf/serviceprincipalname.md) Element enthält. wird in der WSDL-Datei generiert.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="e8f3b-112">Wenn der `LocalSystem`Dienst unter dem Konto, `NetworkService` `LocalService`oder ausgeführt wird, `host/` \<wird standardmäßig ein Dienst Prinzipal Name (Service Principal Name, SPN) in der Form *Hostname*> generiert, da diese Konten Zugriff auf haben. die SPN-Daten des Computers.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="e8f3b-113">Wenn der Dienst unter einem anderen Konto ausgeführt wird, generiert Windows Communication Foundation (WCF) \<einen UPN in der Form *Benutzername*>@<*Domain Name*`>`.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="e8f3b-114">Die Kerberos-Authentifizierung erfordert nämlich, dass für den Client ein UPN oder SPN zum Authentifizieren des Dienstes bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="e8f3b-115">Sie können auch das Tool Setspn.exe zur Registrierung eines zusätzlichen SPN beim Konto eines Dienstes in einer Domäne verwenden.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="e8f3b-116">Sie können dann den SPN als die Identität des Dienstes verwenden.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="e8f3b-117">Informationen zum Herunterladen des Tools [finden Sie unter Windows 2000 Resource Kit-Tool: Setspn. exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="e8f3b-118">Weitere Informationen zum Tool finden Sie unter [setspn Overview (Übersicht über Setspn](https://go.microsoft.com/fwlink/?LinkId=61374)).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-118">For more information about the tool, see [Setspn Overview](https://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e8f3b-119">Zur Verwendung des Windows-Anmeldeinformationstyps ohne Aushandlung muss das Benutzerkonto des Dienstes Zugriff auf den bei der Active Directory-Domäne registrierten SPN haben.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="e8f3b-120">Dazu stehen Ihnen folgende Möglichkeiten zur Verfügung:</span><span class="sxs-lookup"><span data-stu-id="e8f3b-120">You can do this in the following ways:</span></span>  
  
- <span data-ttu-id="e8f3b-121">Verwenden Sie das NetworkService- oder das LocalSystem-Konto, um den Dienst auszuführen.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="e8f3b-122">Da diese Konten Zugriff auf den Computer-SPN haben, der hergestellt wird, wenn der Computer der Active Directory Domäne Beitritt, generiert WCF automatisch das entsprechende SPN-Element innerhalb des Dienst Endpunkts in den Dienst Metadaten (WSDL).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
- <span data-ttu-id="e8f3b-123">Verwenden Sie ein beliebiges Active Directory-Domänenkonto, um den Dienst auszuführen.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="e8f3b-124">Erstellen Sie in diesem Fall mit dem Tool Setspn.exe einen SPN für dieses Domänenkonto.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="e8f3b-125">Nachdem Sie den SPN für das Dienst Konto erstellt haben, konfigurieren Sie WCF so, dass dieser SPN über seine Metadaten (WSDL) auf den Clients des dienstanders veröffentlicht wird.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="e8f3b-126">Legen Sie dazu die Endpunktidentität für den angezeigten Endpunkt entweder mit einer Anwendungskonfigurationsdatei oder mit Code fest.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="e8f3b-127">Weitere Informationen zu SPNs, zum Kerberos-Protokoll und Active Directory finden Sie in der [technischen Ergänzung zu Kerberos für Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="e8f3b-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="e8f3b-128">Wenn SPN oder UPN der leeren Zeichenfolge entspricht</span><span class="sxs-lookup"><span data-stu-id="e8f3b-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="e8f3b-129">Das Festlegen von SPN oder UPN gleich einer leeren Zeichenfolge führt abhängig von der Sicherheitsebene und dem verwendeten Authentifizierungsmodus zu verschiedenen Ergebnissen:</span><span class="sxs-lookup"><span data-stu-id="e8f3b-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
- <span data-ttu-id="e8f3b-130">Wenn Sie Sicherheit auf Transportebene verwenden, wird die NT LanMan (NTLM)-Authentifizierung ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
- <span data-ttu-id="e8f3b-131">Wenn Sie Sicherheit auf Nachrichtenebene verwenden, schlägt die Authentifizierung abhängig vom Authentifizierungsmodus möglicherweise fehl:</span><span class="sxs-lookup"><span data-stu-id="e8f3b-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
- <span data-ttu-id="e8f3b-132">Wenn Sie den `spnego`-Modus verwenden und das `AllowNtlm`-Attribut auf `false` festgelegt ist, schlägt die Authentifizierung fehl.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
- <span data-ttu-id="e8f3b-133">Verwenden Sie den `spnego`-Modus verwenden und ist das `AllowNtlm`-Attribut auf `true` festgelegt, schlägt die Authentifizierung fehl, wenn der UPN leer ist; sie ist jedoch erfolgreich, wenn der SPN leer ist.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
- <span data-ttu-id="e8f3b-134">Wenn Sie Kerberos direkt (wird auch als "One-Shot" bezeichnet) verwenden, schlägt die Authentifizierung fehl.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="e8f3b-135">Verwenden des \<Identity >-Elements in der Konfiguration</span><span class="sxs-lookup"><span data-stu-id="e8f3b-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="e8f3b-136">Wenn Sie den Clientanmeldeinformationstyp in der zuvor gezeigten Bindung zu Certificate`,` ändern, enthält die generierte WSDL ein serialisiertes Base64-X.509-Zertifikat als Identitätswert, wie im folgenden Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="e8f3b-137">Dies ist der Standard für alle Clientanmeldeinformationstypen außer Windows.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-137">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="e8f3b-138">Sie können den Wert der Standard Dienst Identität ändern oder den Typ der Identität ändern, indem Sie das <`identity`>-Element in der Konfiguration verwenden oder die Identität im Code festlegen.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="e8f3b-139">Der folgende Konfigurationscode legt eine DNS-Identität (Domain Name System) mit dem Wert `contoso.com` fest.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="setting-identity-programmatically"></a><span data-ttu-id="e8f3b-140">Programmgesteuertes Festlegen der Identität</span><span class="sxs-lookup"><span data-stu-id="e8f3b-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="e8f3b-141">Ihr Dienst muss eine Identität nicht explizit angeben, da Sie von WCF automatisch bestimmt wird.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="e8f3b-142">WCF ermöglicht es Ihnen jedoch, eine Identität für einen Endpunkt anzugeben, falls dies erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="e8f3b-143">Mit dem folgenden Code wird ein neuer Dienstendpunkt mit einer bestimmten DNS-Identität hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="e8f3b-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="e8f3b-144">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="e8f3b-144">See also</span></span>

- [<span data-ttu-id="e8f3b-145">Vorgehensweise: Erstellen einer benutzerdefinierten Client Identitätsüberprüfung</span><span class="sxs-lookup"><span data-stu-id="e8f3b-145">How to: Create a Custom Client Identity Verifier</span></span>](how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="e8f3b-146">Dienstidentität und Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="e8f3b-146">Service Identity and Authentication</span></span>](../feature-details/service-identity-and-authentication.md)
