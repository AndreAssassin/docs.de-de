---
title: 'Vorgehensweise: Verwenden von separaten X.509-Zertifikaten zum Signieren und Verschlüsseln'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: fc5b40bec7c53c9884379658ddce6d036032f160
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/28/2019
ms.locfileid: "64617599"
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="63bd5-102">Vorgehensweise: Verwenden von separaten X.509-Zertifikaten zum Signieren und Verschlüsseln</span><span class="sxs-lookup"><span data-stu-id="63bd5-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>
<span data-ttu-id="63bd5-103">In diesem Thema zeigt, wie so konfigurieren Sie Windows Communication Foundation (WCF), um verschiedene Zertifikate für die nachrichtensignierung und-Verschlüsselung auf dem Client und dem Dienst verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="63bd5-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>  
  
 <span data-ttu-id="63bd5-104">Damit können verschiedene Zertifikate für Signierung und Verschlüsselung verwendet werden, müssen bei einem benutzerdefinierten Client oder Dienst Anmeldeinformationen (oder beides) erstellt werden, da WCF nicht über eine API zum Festlegen von mehreren Client- oder Dienstzertifikate bietet.</span><span class="sxs-lookup"><span data-stu-id="63bd5-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="63bd5-105">Außerdem muss ein Sicherheitstokenmanager zur Verfügung gestellt werden, um die Informationen der Zertifikate zu nutzen und einen entsprechenden Sicherheitstokenanbieter für die angegebene Schlüsselverwendung und Nachrichtenrichtung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="63bd5-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>  
  
 <span data-ttu-id="63bd5-106">Das folgende Diagramm enthält die wichtigsten verwendeten Klassen, die Klassen, von denen geerbt wird (gekennzeichnet durch einen Aufwärtspfeil), sowie die Rückgabetypen bestimmter Methoden und Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="63bd5-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>  
  
- <span data-ttu-id="63bd5-107">`MyClientCredentials` ist eine benutzerdefinierte Implementierung von <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="63bd5-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>  
  
    - <span data-ttu-id="63bd5-108">Alle im Diagramm enthaltenen Eigenschaften geben Instanzen von <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> zurück.</span><span class="sxs-lookup"><span data-stu-id="63bd5-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>  
  
    - <span data-ttu-id="63bd5-109">Von der <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A>-Methode wird eine Instanz von `MyClientCredentialsSecurityTokenManager` zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="63bd5-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>  
  
- <span data-ttu-id="63bd5-110">`MyClientCredentialsSecurityTokenManager` ist eine benutzerdefinierte Implementierung von <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="63bd5-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>  
  
    - <span data-ttu-id="63bd5-111">Von der <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode wird eine Instanz von <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider> zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="63bd5-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>  
  
 <span data-ttu-id="63bd5-112">![Diagramm mit der Verwendung von Clientanmeldeinformationen](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span><span class="sxs-lookup"><span data-stu-id="63bd5-112">![Chart showing how client credentials are used](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>  
  
 <span data-ttu-id="63bd5-113">Weitere Informationen zu benutzerdefinierten Anmeldeinformationen finden Sie unter [Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="63bd5-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
 <span data-ttu-id="63bd5-114">Darüber hinaus muss eine Prüfung für die benutzerdefinierte Identität erstellt werden, die dann in einer benutzerdefinierten Bindung mit einem benutzerdefinierten Sicherheitsbindungselement verknüpft werden muss.</span><span class="sxs-lookup"><span data-stu-id="63bd5-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="63bd5-115">Des Weiteren müssen anstelle der Standardanmeldeinformationen die benutzerdefinierten Anmeldeinformationen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="63bd5-115">You must also use the custom credentials instead of the default credentials.</span></span>  
  
 <span data-ttu-id="63bd5-116">Das folgende Diagramm gibt Aufschluss über die Klassen für die benutzerdefinierte Bindung sowie über die Verknüpfung der Prüfung der benutzerdefinierten Identität.</span><span class="sxs-lookup"><span data-stu-id="63bd5-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="63bd5-117">An diesem Prozess sind mehrere Bindungselemente beteiligt, die alle von <xref:System.ServiceModel.Channels.BindingElement> erben.</span><span class="sxs-lookup"><span data-stu-id="63bd5-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="63bd5-118">Das <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> besitzt die <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>-Eigenschaft, die eine Instanz von <xref:System.ServiceModel.Security.IdentityVerifier> zurückgibt, von der aus `MyIdentityVerifier` angepasst wird.</span><span class="sxs-lookup"><span data-stu-id="63bd5-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>  
  
 <span data-ttu-id="63bd5-119">![Diagramm mit der ein benutzerdefiniertes Bindungselement](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="63bd5-119">![Chart showing a custom binding element](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>  
  
 <span data-ttu-id="63bd5-120">Weitere Informationen zum Erstellen einer benutzerdefinierten identitätsüberprüfung finden Sie unter Vorgehensweise: [Vorgehensweise: Erstellen eine benutzerdefinierten Clientidentitätsüberprüfung](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span><span class="sxs-lookup"><span data-stu-id="63bd5-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span></span>  
  
### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="63bd5-121">So verwenden Sie separate Zertifikate für Signieren und Verschlüsselung</span><span class="sxs-lookup"><span data-stu-id="63bd5-121">To use separate certificates for signing and encryption</span></span>  
  
1. <span data-ttu-id="63bd5-122">Definieren Sie eine neue Clientanmeldeinformationen-Klasse, die von der <xref:System.ServiceModel.Description.ClientCredentials>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="63bd5-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="63bd5-123">Implementieren Sie vier neue Eigenschaften, um die Angabe mehrerer Zertifikate zu ermöglichen: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` und `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="63bd5-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="63bd5-124">Überschreiben Sie auch die <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A>-Methode, damit eine Instanz der im nächsten Schritt eingerichteten benutzerdefinierten <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>-Klasse zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="63bd5-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]  
  
2. <span data-ttu-id="63bd5-125">Definieren Sie einen neuen Clientsicherheitstoken-Manager, der von der <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="63bd5-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="63bd5-126">Überschreiben Sie die <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode, um einen entsprechenden Sicherheitstokenanbieter zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="63bd5-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="63bd5-127">Der `requirement`-Parameter <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) stellt die Nachrichtenrichtung und die Schlüsselverwendung zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="63bd5-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]  
  
3. <span data-ttu-id="63bd5-128">Definieren Sie eine neue Dienstanmeldeinformationen-Klasse, die von der <xref:System.ServiceModel.Description.ServiceCredentials>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="63bd5-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="63bd5-129">Implementieren Sie vier neue Eigenschaften, um die Angabe mehrerer Zertifikate zu ermöglichen: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` und `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="63bd5-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="63bd5-130">Überschreiben Sie auch die <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A>-Methode, damit eine Instanz der im nächsten Schritt eingerichteten benutzerdefinierten <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>-Klasse zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="63bd5-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]  
  
4. <span data-ttu-id="63bd5-131">Definieren Sie einen neuen Dienstsicherheitstoken-Manager, der von der <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="63bd5-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="63bd5-132">Überschreiben Sie die <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode, um anhand der angegebenen Nachrichtenrichtung und Schlüsselverwendung einen entsprechenden Sicherheitstokenanbieter zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="63bd5-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]  
  
### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="63bd5-133">So verwenden Sie mehrere Zertifikate über den Client</span><span class="sxs-lookup"><span data-stu-id="63bd5-133">To use multiple certificates on the client</span></span>  
  
1. <span data-ttu-id="63bd5-134">Erstellen Sie eine benutzerdefinierte Bindung.</span><span class="sxs-lookup"><span data-stu-id="63bd5-134">Create a custom binding.</span></span> <span data-ttu-id="63bd5-135">Das Sicherheitsbindungselement muss im Duplexmodus ausgeführt werden, damit für Anforderungen und Antworten verschiedene Sicherheitstokenanbieter zur Verfügung stehen können.</span><span class="sxs-lookup"><span data-stu-id="63bd5-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="63bd5-136">Verwenden Sie dazu einen duplexfähigen Transport oder <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, wie im folgenden Code veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="63bd5-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="63bd5-137">Verknüpfen Sie den angepassten <xref:System.ServiceModel.Security.IdentityVerifier>, der im nächsten Schritt definiert wird, mit dem Sicherheitsbindungselement.</span><span class="sxs-lookup"><span data-stu-id="63bd5-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="63bd5-138">Ersetzen Sie die standardmäßigen Clientanmeldeinformationen mit den angepassten Clientanmeldeinformationen, die zuvor erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="63bd5-138">Replace the default client credentials with the customized client credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]  
  
2. <span data-ttu-id="63bd5-139">Definieren Sie einen benutzerdefinierten <xref:System.ServiceModel.Security.IdentityVerifier>.</span><span class="sxs-lookup"><span data-stu-id="63bd5-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="63bd5-140">Der Dienst verfügt über mehrere Identitäten, da zum Verschlüsseln der Anforderung und zum Signieren der Antwort verschiedene Zertifikate verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="63bd5-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="63bd5-141">Im folgenden Beispiel führt die zur Verfügung gestellte benutzerdefinierte Identitätsprüfung zu Demonstrationszwecken keine Überprüfung der Endpunktidentität durch.</span><span class="sxs-lookup"><span data-stu-id="63bd5-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="63bd5-142">Dies ist keine empfohlene Vorgehensweise für Produktionscode.</span><span class="sxs-lookup"><span data-stu-id="63bd5-142">This is not recommended practice for production code.</span></span>  
  
     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]  
  
### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="63bd5-143">So verwenden Sie mehrere Zertifikate für den Dienst</span><span class="sxs-lookup"><span data-stu-id="63bd5-143">To use multiple certificates on the service</span></span>  
  
1. <span data-ttu-id="63bd5-144">Erstellen Sie eine benutzerdefinierte Bindung.</span><span class="sxs-lookup"><span data-stu-id="63bd5-144">Create a custom binding.</span></span> <span data-ttu-id="63bd5-145">Das Sicherheitsbindungselement muss im Duplexmodus ausgeführt werden, damit für Anforderungen und Antworten verschiedene Sicherheitstokenanbieter zur Verfügung stehen können.</span><span class="sxs-lookup"><span data-stu-id="63bd5-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="63bd5-146">Verwenden Sie dazu ebenso wie mit dem Client einen duplexfähigen Transport oder <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, wie im folgenden Code veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="63bd5-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="63bd5-147">Ersetzen Sie die standardmäßigen Dienstanmeldeinformationen mit den angepassten Dienstanmeldeinformationen, die zuvor erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="63bd5-147">Replace the default service credentials with the customized service credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="63bd5-148">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="63bd5-148">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.IdentityVerifier>
- [<span data-ttu-id="63bd5-149">Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="63bd5-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
