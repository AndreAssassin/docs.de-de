---
title: 'Vorgehensweise: Verwenden von separaten X.509-Zertifikaten zum Signieren und Verschlüsseln'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: e464aff46f311ede1cd629fb459ade9a6e627d59
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/07/2019
ms.locfileid: "70796962"
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="e85a9-102">Vorgehensweise: Verwenden von separaten X.509-Zertifikaten zum Signieren und Verschlüsseln</span><span class="sxs-lookup"><span data-stu-id="e85a9-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>

<span data-ttu-id="e85a9-103">In diesem Thema wird gezeigt, wie Windows Communication Foundation (WCF) für die Verwendung unterschiedlicher Zertifikate für die Nachrichten Signierung und-Verschlüsselung auf dem Client und dem Dienst konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="e85a9-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>

<span data-ttu-id="e85a9-104">Um separate Zertifikate für Signierung und Verschlüsselung zu aktivieren, müssen benutzerdefinierte Client-oder Dienst Anmelde Informationen (oder beides) erstellt werden, da WCF keine API bereitstellt, um mehrere Client-oder Dienst Zertifikate festzulegen.</span><span class="sxs-lookup"><span data-stu-id="e85a9-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="e85a9-105">Außerdem muss ein Sicherheitstokenmanager zur Verfügung gestellt werden, um die Informationen der Zertifikate zu nutzen und einen entsprechenden Sicherheitstokenanbieter für die angegebene Schlüsselverwendung und Nachrichtenrichtung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e85a9-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>

<span data-ttu-id="e85a9-106">Das folgende Diagramm enthält die wichtigsten verwendeten Klassen, die Klassen, von denen geerbt wird (gekennzeichnet durch einen Aufwärtspfeil), sowie die Rückgabetypen bestimmter Methoden und Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="e85a9-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>

- <span data-ttu-id="e85a9-107">`MyClientCredentials` ist eine benutzerdefinierte Implementierung von <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="e85a9-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>

  - <span data-ttu-id="e85a9-108">Alle im Diagramm enthaltenen Eigenschaften geben Instanzen von <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> zurück.</span><span class="sxs-lookup"><span data-stu-id="e85a9-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>

  - <span data-ttu-id="e85a9-109">Von der <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A>-Methode wird eine Instanz von `MyClientCredentialsSecurityTokenManager` zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e85a9-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>

- <span data-ttu-id="e85a9-110">`MyClientCredentialsSecurityTokenManager` ist eine benutzerdefinierte Implementierung von <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="e85a9-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

  - <span data-ttu-id="e85a9-111">Von der <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode wird eine Instanz von <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider> zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="e85a9-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>

<span data-ttu-id="e85a9-112">![Diagramm, das zeigt, wie Client Anmelde Informationen verwendet werden](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-B36F-7e6b2b0d610f")</span><span class="sxs-lookup"><span data-stu-id="e85a9-112">![Chart showing how client credentials are used](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>

<span data-ttu-id="e85a9-113">Weitere Informationen zu benutzerdefinierten Anmelde Informationen finden [Sie unter Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client-](walkthrough-creating-custom-client-and-service-credentials.md)und Dienst Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="e85a9-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>

<span data-ttu-id="e85a9-114">Darüber hinaus muss eine Prüfung für die benutzerdefinierte Identität erstellt werden, die dann in einer benutzerdefinierten Bindung mit einem benutzerdefinierten Sicherheitsbindungselement verknüpft werden muss.</span><span class="sxs-lookup"><span data-stu-id="e85a9-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="e85a9-115">Des Weiteren müssen anstelle der Standardanmeldeinformationen die benutzerdefinierten Anmeldeinformationen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e85a9-115">You must also use the custom credentials instead of the default credentials.</span></span>

<span data-ttu-id="e85a9-116">Das folgende Diagramm gibt Aufschluss über die Klassen für die benutzerdefinierte Bindung sowie über die Verknüpfung der Prüfung der benutzerdefinierten Identität.</span><span class="sxs-lookup"><span data-stu-id="e85a9-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="e85a9-117">An diesem Prozess sind mehrere Bindungselemente beteiligt, die alle von <xref:System.ServiceModel.Channels.BindingElement> erben.</span><span class="sxs-lookup"><span data-stu-id="e85a9-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="e85a9-118">Das <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> besitzt die <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>-Eigenschaft, die eine Instanz von <xref:System.ServiceModel.Security.IdentityVerifier> zurückgibt, von der aus `MyIdentityVerifier` angepasst wird.</span><span class="sxs-lookup"><span data-stu-id="e85a9-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>

<span data-ttu-id="e85a9-119">![Diagramm, das ein benutzerdefiniertes Bindungs Element anzeigt](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="e85a9-119">![Chart showing a custom binding element](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>

<span data-ttu-id="e85a9-120">Weitere Informationen zum Erstellen eines benutzerdefinierten Identitäts verifizierers finden Sie unter Gewusst wie: [Vorgehensweise: Erstellen Sie eine benutzerdefinierte Client Identitäts](how-to-create-a-custom-client-identity-verifier.md)Überprüfung.</span><span class="sxs-lookup"><span data-stu-id="e85a9-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](how-to-create-a-custom-client-identity-verifier.md).</span></span>

### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="e85a9-121">So verwenden Sie separate Zertifikate für Signieren und Verschlüsselung</span><span class="sxs-lookup"><span data-stu-id="e85a9-121">To use separate certificates for signing and encryption</span></span>

1. <span data-ttu-id="e85a9-122">Definieren Sie eine neue Clientanmeldeinformationen-Klasse, die von der <xref:System.ServiceModel.Description.ClientCredentials>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="e85a9-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="e85a9-123">Implementieren Sie vier neue Eigenschaften, um die Angabe mehrerer Zertifikate zu ermöglichen: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` und `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="e85a9-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="e85a9-124">Überschreiben Sie auch die <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A>-Methode, damit eine Instanz der im nächsten Schritt eingerichteten benutzerdefinierten <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>-Klasse zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e85a9-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]

2. <span data-ttu-id="e85a9-125">Definieren Sie einen neuen Clientsicherheitstoken-Manager, der von der <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="e85a9-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="e85a9-126">Überschreiben Sie die <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode, um einen entsprechenden Sicherheitstokenanbieter zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e85a9-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="e85a9-127">Der `requirement`-Parameter <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) stellt die Nachrichtenrichtung und die Schlüsselverwendung zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="e85a9-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]

3. <span data-ttu-id="e85a9-128">Definieren Sie eine neue Dienstanmeldeinformationen-Klasse, die von der <xref:System.ServiceModel.Description.ServiceCredentials>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="e85a9-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="e85a9-129">Implementieren Sie vier neue Eigenschaften, um die Angabe mehrerer Zertifikate zu ermöglichen: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate` und `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="e85a9-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="e85a9-130">Überschreiben Sie auch die <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A>-Methode, damit eine Instanz der im nächsten Schritt eingerichteten benutzerdefinierten <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>-Klasse zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e85a9-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]

4. <span data-ttu-id="e85a9-131">Definieren Sie einen neuen Dienstsicherheitstoken-Manager, der von der <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="e85a9-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="e85a9-132">Überschreiben Sie die <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode, um anhand der angegebenen Nachrichtenrichtung und Schlüsselverwendung einen entsprechenden Sicherheitstokenanbieter zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e85a9-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]

### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="e85a9-133">So verwenden Sie mehrere Zertifikate über den Client</span><span class="sxs-lookup"><span data-stu-id="e85a9-133">To use multiple certificates on the client</span></span>

1. <span data-ttu-id="e85a9-134">Erstellen Sie eine benutzerdefinierte Bindung.</span><span class="sxs-lookup"><span data-stu-id="e85a9-134">Create a custom binding.</span></span> <span data-ttu-id="e85a9-135">Das Sicherheitsbindungselement muss im Duplexmodus ausgeführt werden, damit für Anforderungen und Antworten verschiedene Sicherheitstokenanbieter zur Verfügung stehen können.</span><span class="sxs-lookup"><span data-stu-id="e85a9-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="e85a9-136">Verwenden Sie dazu einen duplexfähigen Transport oder <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, wie im folgenden Code veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="e85a9-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="e85a9-137">Verknüpfen Sie den angepassten <xref:System.ServiceModel.Security.IdentityVerifier>, der im nächsten Schritt definiert wird, mit dem Sicherheitsbindungselement.</span><span class="sxs-lookup"><span data-stu-id="e85a9-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="e85a9-138">Ersetzen Sie die standardmäßigen Clientanmeldeinformationen mit den angepassten Clientanmeldeinformationen, die zuvor erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="e85a9-138">Replace the default client credentials with the customized client credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]

2. <span data-ttu-id="e85a9-139">Definieren Sie einen benutzerdefinierten <xref:System.ServiceModel.Security.IdentityVerifier>.</span><span class="sxs-lookup"><span data-stu-id="e85a9-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="e85a9-140">Der Dienst verfügt über mehrere Identitäten, da zum Verschlüsseln der Anforderung und zum Signieren der Antwort verschiedene Zertifikate verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e85a9-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>

    > [!NOTE]
    > <span data-ttu-id="e85a9-141">Im folgenden Beispiel führt die zur Verfügung gestellte benutzerdefinierte Identitätsprüfung zu Demonstrationszwecken keine Überprüfung der Endpunktidentität durch.</span><span class="sxs-lookup"><span data-stu-id="e85a9-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="e85a9-142">Dies ist keine empfohlene Vorgehensweise für Produktionscode.</span><span class="sxs-lookup"><span data-stu-id="e85a9-142">This is not recommended practice for production code.</span></span>

     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]

### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="e85a9-143">So verwenden Sie mehrere Zertifikate für den Dienst</span><span class="sxs-lookup"><span data-stu-id="e85a9-143">To use multiple certificates on the service</span></span>

1. <span data-ttu-id="e85a9-144">Erstellen Sie eine benutzerdefinierte Bindung.</span><span class="sxs-lookup"><span data-stu-id="e85a9-144">Create a custom binding.</span></span> <span data-ttu-id="e85a9-145">Das Sicherheitsbindungselement muss im Duplexmodus ausgeführt werden, damit für Anforderungen und Antworten verschiedene Sicherheitstokenanbieter zur Verfügung stehen können.</span><span class="sxs-lookup"><span data-stu-id="e85a9-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="e85a9-146">Verwenden Sie dazu ebenso wie mit dem Client einen duplexfähigen Transport oder <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement>, wie im folgenden Code veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="e85a9-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="e85a9-147">Ersetzen Sie die standardmäßigen Dienstanmeldeinformationen mit den angepassten Dienstanmeldeinformationen, die zuvor erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="e85a9-147">Replace the default service credentials with the customized service credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]

## <a name="see-also"></a><span data-ttu-id="e85a9-148">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="e85a9-148">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.IdentityVerifier>
- [<span data-ttu-id="e85a9-149">Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client-und Dienst Anmelde Informationen</span><span class="sxs-lookup"><span data-stu-id="e85a9-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
