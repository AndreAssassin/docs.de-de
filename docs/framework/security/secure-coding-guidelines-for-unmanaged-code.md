---
title: Richtlinien für das Schreiben von sicherem, nicht verwaltetem Code
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 867157b329218b79c8cc1255b2158bbe83666531
ms.sourcegitcommit: 289e06e904b72f34ac717dbcc5074239b977e707
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/17/2019
ms.locfileid: "71045365"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="4adc3-102">Richtlinien für das Schreiben von sicherem, nicht verwaltetem Code</span><span class="sxs-lookup"><span data-stu-id="4adc3-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="4adc3-103">Bestimmter Bibliothekscode muss nicht verwalteten Code aufrufen (z. B. APIs in systemeigenem Code, etwa Win32).</span><span class="sxs-lookup"><span data-stu-id="4adc3-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="4adc3-104">Hierbei ist größte Vorsicht geboten, denn dies bedeutet, dass der Sicherheitsbereich für verwalteten Code verlassen wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="4adc3-105">Wenn Ihr Code sicherheitsneutral ist, müssen sowohl Ihr Code als auch jeder Code, der Ihren Code aufruft, eine Berechtigung für nicht verwalteten Code haben (<xref:System.Security.Permissions.SecurityPermission> mit angegebenem <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> -Flag).</span><span class="sxs-lookup"><span data-stu-id="4adc3-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="4adc3-106">Häufig ist es jedoch nicht sinnvoll, dem Aufrufer so weit reichende Berechtigungen zu gewähren.</span><span class="sxs-lookup"><span data-stu-id="4adc3-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="4adc3-107">In solchen Fällen kann Ihr vertrauenswürdiger Code das Bindeglied sein, vergleichbar mit dem verwalteten Wrapper- oder Bibliothekscode, der unter [Sichern von Wrappercode](../misc/securing-wrapper-code.md)beschrieben ist.</span><span class="sxs-lookup"><span data-stu-id="4adc3-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="4adc3-108">Wenn die Funktionalität des zugrunde liegenden nicht verwalteten Codes vollständig sicher ist, kann dieser direkt verfügbar gemacht werden. Andernfalls ist zuerst eine geeignete Berechtigungsüberprüfung (Forderung) erforderlich.</span><span class="sxs-lookup"><span data-stu-id="4adc3-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="4adc3-109">Wenn Ihr Code nicht verwalteten Code aufruft, Sie aber nicht möchten, dass ein Aufrufer die Berechtigung zum Zugriff auf nicht verwalteten Code haben muss, müssen Sie diese Berechtigung bestätigen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="4adc3-110">Eine Bestätigung blockiert den Stackwalk entsprechend Ihrem Rahmen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="4adc3-111">Sie müssen vorsichtig sein, dass Sie keine Sicherheitslücke in diesem Prozess erstellen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="4adc3-112">In der Regel bedeutet dies, dass Sie eine geeignete Berechtigung für Aufrufer fordern und dann nicht verwalteten Code verwenden, um nur genau die Aktionen auszuführen, die durch diese Berechtigung zugelassen sind.</span><span class="sxs-lookup"><span data-stu-id="4adc3-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="4adc3-113">In einigen Fällen (z. B. eine Funktion zum Abrufen der Tageszeit) kann nicht verwalteter Code direkt ohne Sicherheitsüberprüfungen verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="4adc3-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="4adc3-114">In jedem Fall muss jeglicher Code, der eine Bestätigung gibt, die Sicherheit gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="4adc3-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="4adc3-115">Da verwalteter Code, der einen Codepfad zu systemeigenem Code bereitstellt, ein potenzielles Ziel für Schadsoftware ist, muss mit besonderer Sorgfalt ermittelt werden, welcher Code sicher verwendet werden kann und wie dieser Code zu verwenden ist.</span><span class="sxs-lookup"><span data-stu-id="4adc3-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="4adc3-116">Üblicherweise sollte nicht verwalteter Code nie direkt für teilweise vertrauenswürdige Aufrufer verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="4adc3-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="4adc3-117">Es gibt zwei Hauptaspekte für die Bewertung der Sicherheit des Verwendens von nicht verwaltetem Code in Bibliotheken, die von teilweise vertrauenswürdigem Code aufgerufen werden können:</span><span class="sxs-lookup"><span data-stu-id="4adc3-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
- <span data-ttu-id="4adc3-118">**Funktionalität**.</span><span class="sxs-lookup"><span data-stu-id="4adc3-118">**Functionality**.</span></span> <span data-ttu-id="4adc3-119">Stellt die nicht verwaltete API Funktionen bereit, die Aufrufer daran hindern, potenziell gefährliche Vorgänge auszuführen?</span><span class="sxs-lookup"><span data-stu-id="4adc3-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="4adc3-120">Für Codezugriffssicherheit werden Berechtigungen verwendet, um Zugriff auf Ressourcen zu erzwingen. Ermitteln Sie also, ob die API Dateien, eine Benutzeroberfläche oder Threading verwendet oder ob sie geschützte Informationen verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="4adc3-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="4adc3-121">Ist dies der Fall ist, muss der verwaltete Code, in den die API eingebettet ist, die erforderlichen Berechtigungen anfordern, bevor zugelassen wird, dass sie ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="4adc3-122">Darüber hinaus muss Speicherzugriff, solange er nicht durch eine Berechtigung geschützt ist, auf strikte Typsicherheit beschränkt werden.</span><span class="sxs-lookup"><span data-stu-id="4adc3-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
- <span data-ttu-id="4adc3-123">**Parameterüberprüfung**.</span><span class="sxs-lookup"><span data-stu-id="4adc3-123">**Parameter checking**.</span></span> <span data-ttu-id="4adc3-124">Bei einem verbreiteten Angriff werden unerwartete Parameter an verfügbar gemachte nicht verwaltete API-Methoden übergeben, um diese zu einer nicht ordnungsgemäßen Ausführung zu veranlassen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="4adc3-125">Pufferüberläufe mit bereichsüberschreitenden Index- oder Offsetwerten sind ein typisches Beispiel für diese Art von Angriffen wie auch jegliche Parameter, die möglicherweise einen Fehler im zugrunde liegenden Code ausnutzen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="4adc3-126">Daher muss verwalteter Code selbst dann, wenn der nicht verwaltete Code einer API (nach den nötigen Anforderungen) für teilweise vertrauenswürdige Aufrufer funktional sicher ist, auch umfassend die Parametergültigkeit prüfen, um sicherzustellen, dass aus Schadsoftware keine unbeabsichtigten Aufrufe möglich sind, indem die Wrapperebene von verwaltetem Code verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="4adc3-127">Verwenden von SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="4adc3-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="4adc3-128">Für ein Bestätigen und anschließendes Aufrufen von nicht verwaltetem Code ist ein Leistungsaspekt zu beachten.</span><span class="sxs-lookup"><span data-stu-id="4adc3-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="4adc3-129">Für jeden solchen Aufruf fordert das Sicherheitssystem automatisch die Berechtigung für den nicht verwalteten Code an, wodurch jedes Mal ein Stackwalk ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="4adc3-130">Wenn Sie nicht verwalteten Code bestätigen und sofort aufrufen, kann der Stackwalk bedeutungslos sein: Er besteht aus Ihrer Bestätigung und Ihrem Aufruf des nicht verwalteten Codes.</span><span class="sxs-lookup"><span data-stu-id="4adc3-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="4adc3-131">Das benutzerdefinierte Attribut <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> kann auf Einstiegspunkte von nicht verwaltetem Code angewendet werden, um die normale Sicherheitsüberprüfung zu deaktivieren, die von <xref:System.Security.Permissions.SecurityPermission> mit angegebener <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> -Berechtigung gefordert wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="4adc3-132">Für diese Vorgehensweise ist immer äußerste Vorsicht geboten, da diese Aktion eine offene Tür für nicht verwalteten Code ohne Runtime-Sicherheitsüberprüfungen zur Folge hat.</span><span class="sxs-lookup"><span data-stu-id="4adc3-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="4adc3-133">Beachten Sie, dass selbst bei Anwendung des **SuppressUnmanagedCodeSecurityAttribute** -Attributs eine einmalige Sicherheitsüberprüfung erfolgt, die bei der JIT-Kompilierung (Just-in-Time) vorgenommen wird, um sicherzustellen, dass der unmittelbare Aufrufer die Berechtigung zum Aufrufen von nicht verwaltetem Code hat.</span><span class="sxs-lookup"><span data-stu-id="4adc3-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="4adc3-134">Wenn Sie **SuppressUnmanagedCodeSecurityAttribute**verwenden, sollten Sie die folgenden Punkte überprüfen:</span><span class="sxs-lookup"><span data-stu-id="4adc3-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
- <span data-ttu-id="4adc3-135">Definieren Sie den Einstiegspunkt in nicht verwalteten Code so, dass er intern ist oder außerhalb Ihres Codes auf andere Weise nicht zugänglich ist.</span><span class="sxs-lookup"><span data-stu-id="4adc3-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
- <span data-ttu-id="4adc3-136">Jeder Aufruf von nicht verwaltetem Code ergibt eine potenzielle Sicherheitslücke.</span><span class="sxs-lookup"><span data-stu-id="4adc3-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="4adc3-137">Vergewissern Sie sich, dass Ihr Code kein Zugang für Schadsoftware ist, um indirekt nicht verwalteten Code aufzurufen und eine Sicherheitsüberprüfung zu umgehen.</span><span class="sxs-lookup"><span data-stu-id="4adc3-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="4adc3-138">Fordern Sie ggf. Berechtigungen an.</span><span class="sxs-lookup"><span data-stu-id="4adc3-138">Demand permissions, if appropriate.</span></span>  
  
- <span data-ttu-id="4adc3-139">Verwenden Sie eine Benennungskonvention, um explizit erkennen zu können, ob Sie einen gefährlichen Pfad zu nicht verwaltetem Code erstellen, wie dies in diesem Abschnitt weiter unten beschrieben ist.</span><span class="sxs-lookup"><span data-stu-id="4adc3-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="4adc3-140">Benennungskonventionen für Methoden in nicht verwaltetem Code</span><span class="sxs-lookup"><span data-stu-id="4adc3-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="4adc3-141">Für das Benennen von Methoden in nicht verwaltetem Code hat sich eine praktische und empfehlenswerte Konvention bewährt.</span><span class="sxs-lookup"><span data-stu-id="4adc3-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="4adc3-142">Alle Methoden in nicht verwaltetem Code werden in drei Kategorien unterteilt: **safe**, **native**, und **unsafe**.</span><span class="sxs-lookup"><span data-stu-id="4adc3-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="4adc3-143">Diese Schlüsselwörter können als Namen von Klassen verwendet werden, in denen die verschiedenen Arten von Einstiegspunkten für nicht verwalteten Code definiert sind.</span><span class="sxs-lookup"><span data-stu-id="4adc3-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="4adc3-144">In Quellcode sollten diese Schlüsselwörter dem jeweiligen Klassennamen hinzugefügt werden, wie beispielsweise in `Safe.GetTimeOfDay`, `Native.Xyz`oder `Unsafe.DangerousAPI`.</span><span class="sxs-lookup"><span data-stu-id="4adc3-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="4adc3-145">Jedes dieser Schlüsselwörter bietet nützliche Sicherheitsinformationen für Entwickler, die diese Klasse verwenden, wie in der folgenden Tabelle beschrieben.</span><span class="sxs-lookup"><span data-stu-id="4adc3-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="4adc3-146">Stichwort</span><span class="sxs-lookup"><span data-stu-id="4adc3-146">Keyword</span></span>|<span data-ttu-id="4adc3-147">Sicherheitsüberlegungen</span><span class="sxs-lookup"><span data-stu-id="4adc3-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="4adc3-148">**safe**</span><span class="sxs-lookup"><span data-stu-id="4adc3-148">**safe**</span></span>|<span data-ttu-id="4adc3-149">Absolut ungefährlich für den Aufruf durch Code, selbst bei Schadsoftware.</span><span class="sxs-lookup"><span data-stu-id="4adc3-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="4adc3-150">Kann wie jeder andere verwaltete Code verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="4adc3-150">Can be used just like other managed code.</span></span> <span data-ttu-id="4adc3-151">Beispielsweise ist eine Funktion, die die Tageszeit abruft, üblicherweise sicher.</span><span class="sxs-lookup"><span data-stu-id="4adc3-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="4adc3-152">**native**</span><span class="sxs-lookup"><span data-stu-id="4adc3-152">**native**</span></span>|<span data-ttu-id="4adc3-153">Sicherheitsneutraler Code, d. h. nicht verwalteter Code, der von nicht verwaltetem Code eine Berechtigung zum Aufruf erfordert.</span><span class="sxs-lookup"><span data-stu-id="4adc3-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="4adc3-154">Die Sicherheit wird überprüft, wodurch ein nicht berechtigter Aufrufer gestoppt wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="4adc3-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="4adc3-155">**unsafe**</span></span>|<span data-ttu-id="4adc3-156">Einstiegspunkt mit unterdrückter Sicherheit für potenziell gefährlichen nicht verwalteten Code .</span><span class="sxs-lookup"><span data-stu-id="4adc3-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="4adc3-157">Entwickler sollten äußerst vorsichtig sein, wenn solcher nicht verwalteter Code verwendet wird, und sie sollten sicherstellen, dass andere Schutzmechanismen greifen, damit ein Sicherheitsrisiko vermieden wird.</span><span class="sxs-lookup"><span data-stu-id="4adc3-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="4adc3-158">Entwickler müssen überlegt vorgehen, denn dieses Schlüsselwort setzt das Sicherheitssystem außer Kraft.</span><span class="sxs-lookup"><span data-stu-id="4adc3-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="4adc3-159">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="4adc3-159">See also</span></span>

- [<span data-ttu-id="4adc3-160">Richtlinien für das Schreiben von sicherem Code</span><span class="sxs-lookup"><span data-stu-id="4adc3-160">Secure Coding Guidelines</span></span>](../../standard/security/secure-coding-guidelines.md)
