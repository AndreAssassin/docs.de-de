---
title: Übersicht über das WSFederation-Authentifizierungsmodul
ms.date: 03/30/2017
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
author: BrucePerlerMS
ms.openlocfilehash: f4dc63272c47dc0cd9eaa15986e4369d9d689b64
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/28/2019
ms.locfileid: "64592368"
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="608f4-102">Übersicht über das WSFederation-Authentifizierungsmodul</span><span class="sxs-lookup"><span data-stu-id="608f4-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="608f4-103">Windows Identity Foundation (WIF) umfasst die Verbundauthentifizierung in ASP.NET-Anwendungen über das WS-Verbundauthentifizierungsmodul (WS-FAM).</span><span class="sxs-lookup"><span data-stu-id="608f4-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="608f4-104">In diesem Thema wird beschrieben, wie Verbundauthentifizierung funktioniert und verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="608f4-105">Übersicht über die Verbundauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="608f4-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="608f4-106">Mit Verbundauthentifizierung kann ein Sicherheitstokendienst (STS) in einer vertrauenswürdigen Domäne Authentifizierungsinformationen für ein STS in einer anderen vertrauenswürdigen Domäne bereitstellen, wenn zwischen den beiden Domänen eine Vertrauensstellung besteht.</span><span class="sxs-lookup"><span data-stu-id="608f4-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="608f4-107">Ein Beispiel hierfür ist in der folgenden Abbildung dargestellt:</span><span class="sxs-lookup"><span data-stu-id="608f4-107">An example of this is shown in the following illustration:</span></span>  
  
 ![Das Diagramm zeigt das Szenario für Verbundauthentifizierung.](./media/wsfederation-authentication-module-overview/federated-authentication.gif)  
  
1. <span data-ttu-id="608f4-109">Ein Client in der vertrauenswürdigen Fabrikam-Domäne sendet eine Anforderung an eine Anwendung der vertrauenden Seite (Relying Party, RP) in der vertrauenswürdigen Contoso-Domäne.</span><span class="sxs-lookup"><span data-stu-id="608f4-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2. <span data-ttu-id="608f4-110">Die vertrauende Seite leitet den Client an einen STS in der vertrauenswürdigen Contoso-Domäne um.</span><span class="sxs-lookup"><span data-stu-id="608f4-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="608f4-111">Dieser STS kennt den Client nicht.</span><span class="sxs-lookup"><span data-stu-id="608f4-111">This STS has no knowledge of the client.</span></span>  
  
3. <span data-ttu-id="608f4-112">Der Contoso-STS leitet den Client an einen STS in der vertrauenswürdigen Fabrikam-Domäne um, zu der seitens der Contoso-Domäne eine Vertrauensstellung besteht.</span><span class="sxs-lookup"><span data-stu-id="608f4-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4. <span data-ttu-id="608f4-113">Der Fabrikam-STS überprüft die Identität des Clients und gibt einen Sicherheitstoken an den Contoso-STS aus.</span><span class="sxs-lookup"><span data-stu-id="608f4-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5. <span data-ttu-id="608f4-114">Der Contoso-STS verwendet das Fabrikam-Token, um sein eigenes Token zu erstellen, das von der vertrauenden Seite verwendet werden kann, und sendet es an die vertrauende Seite.</span><span class="sxs-lookup"><span data-stu-id="608f4-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6. <span data-ttu-id="608f4-115">Die vertrauende Seite extrahiert die Ansprüche des Clients aus dem Sicherheitstoken und trifft eine Autorisierungsentscheidung.</span><span class="sxs-lookup"><span data-stu-id="608f4-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="608f4-116">Verwenden des Verbundauthentifizierungsmoduls mit ASP.NET</span><span class="sxs-lookup"><span data-stu-id="608f4-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="608f4-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) ist ein HTTP-Modul, mit dem Sie einer [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]-Anwendung Verbundauthentifizierung hinzufügen können.</span><span class="sxs-lookup"><span data-stu-id="608f4-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="608f4-118">Mit Verbundauthentifizierung kann der STS Authentifizierungslogik verwenden, sodass Sie sich auf das Schreiben von Geschäftslogik konzentrieren können.</span><span class="sxs-lookup"><span data-stu-id="608f4-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="608f4-119">Bei der Konfiguration des WS-FAM geben Sie den STS an, an den nicht authentifizierte Anforderungen umgeleitet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="608f4-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="608f4-120">Mit WIF können Sie einen Benutzer auf zwei Arten authentifizieren:</span><span class="sxs-lookup"><span data-stu-id="608f4-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1. <span data-ttu-id="608f4-121">Passive Umleitung: Wenn ein nicht authentifizierter Benutzer versucht, eine geschützte Ressource zuzugreifen, und Sie einfach diese an einen STS umleiten ohne eine Anmeldeseite möchten, ist dies der richtige Ansatz.</span><span class="sxs-lookup"><span data-stu-id="608f4-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="608f4-122">Der STS überprüft die Identität des Benutzers und gibt ein Sicherheitstoken aus, das die entsprechenden Ansprüche für diesen Benutzer enthält.</span><span class="sxs-lookup"><span data-stu-id="608f4-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="608f4-123">Für diese Option muss das WS-FAM in der HTTP-Modulpipeline hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="608f4-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="608f4-124">Mit dem Identitäts- und Zugriffs-Tool können Sie in Visual Studio 2012 die Konfigurationsdatei der Anwendung ändern, damit das WS-FAM verwendet und ein Verbund-STS erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="608f4-125">Weitere Informationen finden Sie unter [Identitäts- und Zugriffs-Tool für Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="608f4-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2. <span data-ttu-id="608f4-126">Sie können die <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType>-Methode oder die <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A>-Methode aus dem zugrunde liegenden Code einer Anmeldeseite in der Anwendung der vertrauenden Seiten aufrufen.</span><span class="sxs-lookup"><span data-stu-id="608f4-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="608f4-127">In der passiven Umleitung wird die gesamte Kommunikation durch Antwort/Umleitung vom Client ausgeführt (in der Regel ein Browser).</span><span class="sxs-lookup"><span data-stu-id="608f4-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="608f4-128">Sie können der HTTP-Pipeline der Anwendung das WS-FAM hinzufügen. Hier sucht es nach nicht authentifizierten Benutzeranforderungen und leitet die Benutzer an den angegebenen STS um.</span><span class="sxs-lookup"><span data-stu-id="608f4-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="608f4-129">Das WS-FAM löst außerdem verschiedene Ereignisse aus, mit denen Sie seine Funktionalität in einer [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]-Anwendung anpassen können.</span><span class="sxs-lookup"><span data-stu-id="608f4-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="608f4-130">So funktioniert das WS-FAM</span><span class="sxs-lookup"><span data-stu-id="608f4-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="608f4-131">Das WS-FAM wird in der <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>-Klasse implementiert.</span><span class="sxs-lookup"><span data-stu-id="608f4-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="608f4-132">In der Regel fügen Sie das WS-FAM der HTTP-Pipeline der [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] Anwendung der vertrauenden Seite hinzu.</span><span class="sxs-lookup"><span data-stu-id="608f4-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="608f4-133">Wenn ein nicht authentifizierter Benutzer versucht, auf eine geschützte Ressource zuzugreifen, gibt die vertrauende Seite die HTTP-Antwort „401 Autorisierung verweigert“ zurück.</span><span class="sxs-lookup"><span data-stu-id="608f4-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="608f4-134">Das WS-FAM fängt diese Antwort ab und lässt nicht zu, dass der Client sie erhält. Dann wird der Benutzer direkt auf den angegebenen STS umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="608f4-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="608f4-135">Der STS gibt ein Sicherheitstoken aus, das das WS-FAM erneut abfängt.</span><span class="sxs-lookup"><span data-stu-id="608f4-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="608f4-136">Das WS-FAM verwendet das Token, um eine Instanz von <xref:System.Security.Claims.ClaimsPrincipal> für den authentifizierten Benutzer zu erstellen. Damit können die regulären [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]-Autorisierungsmechanismen funktionieren.</span><span class="sxs-lookup"><span data-stu-id="608f4-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="608f4-137">Da HTTP statusfrei ist, benötigen wir eine Methode, mit der verhindert wird, dass der gesamte Prozess jedes Mal wiederholt wird, wenn der Benutzer versucht, auf eine andere geschützte Ressource zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="608f4-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="608f4-138">Hier setzt das <xref:System.IdentityModel.Services.SessionAuthenticationModule> an.</span><span class="sxs-lookup"><span data-stu-id="608f4-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="608f4-139">Wenn der STS ein Sicherheitstoken für den Benutzer ausgibt, erstellt <xref:System.IdentityModel.Services.SessionAuthenticationModule> auch ein Sitzungssicherheitstoken für den Benutzer und legt es in einem Cookie ab.</span><span class="sxs-lookup"><span data-stu-id="608f4-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="608f4-140">Bei nachfolgenden Anforderungen wird dieses Cookie durch das <xref:System.IdentityModel.Services.SessionAuthenticationModule> abgefangen und dazu verwendet, den <xref:System.Security.Claims.ClaimsPrincipal> des Benutzers zu rekonstruieren.</span><span class="sxs-lookup"><span data-stu-id="608f4-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="608f4-141">Im folgenden Diagramm ist der Gesamtinformationsfluss für eine passive Umleitung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="608f4-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="608f4-142">Die Anforderung wird automatisch über STS umgeleitet, sodass Anmeldeinformationen ohne eine Anmeldeseite erstellt werden:</span><span class="sxs-lookup"><span data-stu-id="608f4-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 ![Das Diagramm, die Anmeldung mithilfe passiver Umleitung zeigt.](./media/wsfederation-authentication-module-overview/sign-in-using-passive-redirect.gif)  
  
 <span data-ttu-id="608f4-144">Das folgende Diagramm zeigt weitere Details dazu, was geschieht, wenn der Benutzer für den STS authentifiziert ist und seine Sicherheitstoken von <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> verarbeitet werden:</span><span class="sxs-lookup"><span data-stu-id="608f4-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="608f4-145">![Zeitliche Steuerung für die Tokenverarbeitung mit passiver Umleitung](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="608f4-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="608f4-146">Das folgende Diagramm zeigt weitere Details dazu, was geschieht, wenn die Sicherheitstoken des Benutzers in Cookies serialisiert wurden und über <xref:System.IdentityModel.Services.SessionAuthenticationModule> abgefangen werden:</span><span class="sxs-lookup"><span data-stu-id="608f4-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="608f4-147">![Diagramm für die zeitliche Steuerung von SAM, das die Anmeldung mithilfe von Steuerelementen zeigt](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="608f4-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="608f4-148">Ereignisse</span><span class="sxs-lookup"><span data-stu-id="608f4-148">Events</span></span>  
 <span data-ttu-id="608f4-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule> und die übergeordnete Klasse <xref:System.IdentityModel.Services.HttpModuleBase> lösen an verschiedenen Punkten der Verarbeitung einer HTTP-Anforderung Ereignisse aus.</span><span class="sxs-lookup"><span data-stu-id="608f4-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="608f4-150">Sie können diese Ereignisse in der Datei `global.asax` der [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]-Anwendung bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="608f4-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
- <span data-ttu-id="608f4-151">Die ASP.NET-Infrastruktur ruft die <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A>-Methode des Moduls auf, um das Modul zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="608f4-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
- <span data-ttu-id="608f4-152">Das <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType>-Ereignis wird ausgelöst, wenn die ASP.NET-Infrastruktur die <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A>-Methode zum ersten Mal für eines der Anwendungsmodule aufruft, die von <xref:System.IdentityModel.Services.HttpModuleBase> abgeleitet sind.</span><span class="sxs-lookup"><span data-stu-id="608f4-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="608f4-153">Diese Methode greift auf die statische <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType>-Eigenschaft zu, mit der die Konfiguration aus der Datei Web.config geladen wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="608f4-154">Dieses Ereignis wird beim ersten Zugriff auf die Eigenschaft ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="608f4-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="608f4-155">Auf das <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>-Objekt, das durch die Konfiguration initialisiert wird, kann durch die <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType>-Eigenschaft in einem Ereignishandler zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="608f4-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="608f4-156">Mit diesem Ereignis können Sie die Konfiguration ändern, bevor sie in allen Modulen angewendet wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="608f4-157">Sie können einen Handler für dieses Ereignis in der Application_Start-Methode hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="608f4-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="608f4-158">Jedes Modul überschreibt die abstrakten Methoden <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> und <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="608f4-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="608f4-159">Die erste dieser Methoden fügt Handler für ASP.NET-Pipelineereignisse hinzu, die für das Modul von Interesse sind.</span><span class="sxs-lookup"><span data-stu-id="608f4-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="608f4-160">In den meisten Fällen genügt die Standardimplementierung des Moduls.</span><span class="sxs-lookup"><span data-stu-id="608f4-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="608f4-161">Die zweite dieser Methoden initialisiert die Eigenschaften des Moduls aus der <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="608f4-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="608f4-162">(Hierbei handelt es sich um eine Kopie der Konfiguration, die bereits geladen wurde). Sie müssen möglicherweise die zweite Methode überschreiben, wenn die Initialisierung neuer Eigenschaften aus einer Konfiguration in Klassen unterstützt werden soll, die Sie von <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> oder <xref:System.IdentityModel.Services.SessionAuthenticationModule> ableiten.</span><span class="sxs-lookup"><span data-stu-id="608f4-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="608f4-163">In solchen Fällen müssen Sie auch von den entsprechenden Konfigurationsobjekten ableiten, damit die hinzugefügten Konfigurationseigenschaften unterstützt werden; zum Beispiel von <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration> oder <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="608f4-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
- <span data-ttu-id="608f4-164">Das WS-FAM löst das <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived>-Ereignis aus, wenn ein Sicherheitstoken abgefangen wird, das durch den STS ausgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="608f4-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
- <span data-ttu-id="608f4-165">Nach der Überprüfung des Tokens löst das WS-FAM das <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated>-Ereignis aus.</span><span class="sxs-lookup"><span data-stu-id="608f4-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
- <span data-ttu-id="608f4-166">Das <xref:System.IdentityModel.Services.SessionAuthenticationModule> löst das <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated>-Ereignis aus, wenn es ein Sitzungssicherheitstoken für den Benutzer erstellt.</span><span class="sxs-lookup"><span data-stu-id="608f4-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
- <span data-ttu-id="608f4-167">Das <xref:System.IdentityModel.Services.SessionAuthenticationModule> löst das <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived>-Ereignis aus, wenn es nachfolgende Anforderungen mit dem Cookie abfängt, das das Sitzungssicherheitstoken enthält.</span><span class="sxs-lookup"><span data-stu-id="608f4-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
- <span data-ttu-id="608f4-168">Bevor das WS-FAM den Benutzer an den Aussteller umleitet, löst es das <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>-Ereignis aus.</span><span class="sxs-lookup"><span data-stu-id="608f4-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="608f4-169">Die Anmeldungsanforderung für den WS-Verbund ist über die <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> -Eigenschaft des <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> verfügbar, das im Ereignis übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="608f4-170">Sie können die Anforderung ändern, bevor Sie sie an den Aussteller senden.</span><span class="sxs-lookup"><span data-stu-id="608f4-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
- <span data-ttu-id="608f4-171">Das WS-FAM löst das <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn>-Ereignis aus, wenn das Cookie erfolgreich geschrieben wurde und der Benutzer angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="608f4-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
- <span data-ttu-id="608f4-172">Das WS-FAM löst das <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut>-Ereignis einmal pro Sitzung aus, da die Sitzung für jeden Benutzer geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="608f4-173">Es wird nicht ausgelöst, wenn die Sitzung clientseitig geschlossen wird (beispielsweise durch Löschen des Sitzungscookie).</span><span class="sxs-lookup"><span data-stu-id="608f4-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="608f4-174">In einer SSO-Umgebung kann der IP-STS auch anfordern, dass sich jede vertrauende Seite abmeldet.</span><span class="sxs-lookup"><span data-stu-id="608f4-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="608f4-175">Damit wird dieses Ereignis ebenfalls ausgelöst, wenn <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> auf `true` festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="608f4-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="608f4-176">Sie sollten die <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType>-Eigenschaft nicht während jedes Ereignisses verwenden, das von <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> oder <xref:System.IdentityModel.Services.SessionAuthenticationModule> ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="608f4-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="608f4-177">Der Grund dafür ist, dass <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> nach den Authentifizierungsprozess festgelegt wird, während Ereignisse während des Authentifizierungsprozesses ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="608f4-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="608f4-178">Konfiguration der Verbundauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="608f4-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="608f4-179">Das WS-FAM und SAM werden über das [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)-Element konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="608f4-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="608f4-180">Das untergeordnete Element [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) konfiguriert Standardwerte für die WS-FAM-Eigenschaften; dazu gehören z.B. die <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A>- und die <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="608f4-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="608f4-181">(Diese Werte können für einzelne Anforderungen geändert werden. Dazu stellen Sie Handler für einige der WS-FAM-Ereignisse bereit; beispielsweise <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) Der von SAM verwendete Cookiehandler wird über das untergeordnete [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md)-Element konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="608f4-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="608f4-182">WIF stellt einen Standardcookiehandler bereit, der in der <xref:System.IdentityModel.Services.ChunkedCookieHandler>-Klasse implementiert wird, deren Segmentgröße über das [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md)-Element festgelegt werden kann.</span><span class="sxs-lookup"><span data-stu-id="608f4-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="608f4-183">Das `<federationConfiguration>`-Element verweist auf ein <xref:System.IdentityModel.Configuration.IdentityConfiguration>, das die Konfiguration für andere WIF-Komponenten bereitstellt, die in der Anwendung verwendet werden, wie z. B. <xref:System.Security.Claims.ClaimsAuthenticationManager> und <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="608f4-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="608f4-184">Auf die Identitätskonfiguration kann explizit durch Angabe eines benannten [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md)-Elements im `identityConfigurationName`-Attribut des `<federationConfiguration>`-Elements verwiesen werden.</span><span class="sxs-lookup"><span data-stu-id="608f4-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="608f4-185">Wenn nicht explizit auf die Identitätskonfiguration verwiesen wird, wird die Standardidentitätskonfiguration verwendet.</span><span class="sxs-lookup"><span data-stu-id="608f4-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="608f4-186">Das folgende XML-Element zeigt eine Konfiguration der vertrauenden Seite einer ASP.NET-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="608f4-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="608f4-187">Die Konfigurationsabschnitte <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> und <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> werden unter dem `<configSections>`-Element hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="608f4-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="608f4-188">Das SAM und das WS-FAM werden den HTTP-Modulen unter dem `<system.webServer>`/`<modules>`-Element hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="608f4-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="608f4-189">Schließlich werden die WIF-Komponenten unter den Elementen `<system.identityModel>`/`<identityConfiguration>` und `<system.identityModel.services>`/`<federationConfiguration>` konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="608f4-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="608f4-190">Mit dieser Konfiguration wird der segmentierte Cookiehandler festgelegt, wenn es sich um den Standardcookiehandler handelt und im `<cookieHandler>`-Element kein Cookiehandlertyp angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="608f4-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="608f4-191">Im folgenden Beispiel werden sowohl das `requireHttps`-Attribut des `<wsFederation>`-Elements und das `requireSsl`-Attribut des `<cookieHandler>`-Elements `false` verwendet.</span><span class="sxs-lookup"><span data-stu-id="608f4-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="608f4-192">Dies stellt ein potenzielles Sicherheitsrisiko dar.</span><span class="sxs-lookup"><span data-stu-id="608f4-192">This presents a potential security threat.</span></span> <span data-ttu-id="608f4-193">In der Produktionsumgebung sollten beide Werte auf `true` gesetzt sein.</span><span class="sxs-lookup"><span data-stu-id="608f4-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="608f4-194">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="608f4-194">See also</span></span>

- <xref:System.IdentityModel.Services.SessionAuthenticationModule>
- <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>
- [<span data-ttu-id="608f4-195">\<federationConfiguration></span><span class="sxs-lookup"><span data-stu-id="608f4-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
