---
title: Verarbeiten von odata-Feeds aus einem Workflow (WF)
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: c9780200d9b7c7bc89797b3c16b22bc38440fccc
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802660"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="409ba-102">Verarbeiten von odata-Feeds aus einem Workflow</span><span class="sxs-lookup"><span data-stu-id="409ba-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="409ba-103">WCF Data Services ist eine Komponente des .NET Framework, die es Ihnen ermöglicht, Dienste zu erstellen, die die Open Data Protocol (odata) verwenden, um Daten mithilfe der Semantik Representational State Transfer (Rest) über das Internet oder Intranet verfügbar zu machen und zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="409ba-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="409ba-104">OData macht Daten als Ressourcen verfügbar, die durch URIs adressierbar sind.</span><span class="sxs-lookup"><span data-stu-id="409ba-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="409ba-105">Mit einem OData-basierten Datendienst kann jede Anwendung interagieren, die HTTP-Anforderungen senden und von einem Datendienst zurückgegebene OData-Feeds verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="409ba-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="409ba-106">Darüber hinaus enthält WCF Data Services Client Bibliotheken, die umfangreichere Programmierfunktionen bieten, wenn Sie odata-Feeds von .NET Framework Anwendungen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="409ba-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="409ba-107">Dieses Thema bietet einen Überblick über die Verarbeitung von OData-Feeds in einem Workflow mit bzw. ohne Clientbibliotheken.</span><span class="sxs-lookup"><span data-stu-id="409ba-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="409ba-108">Verwenden des Beispiel-odata-Dienstanbieter Northwind</span><span class="sxs-lookup"><span data-stu-id="409ba-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="409ba-109">In den Beispielen in diesem Thema wird der Northwind-Beispiel Datendienst unter <https://services.odata.org/Northwind/Northwind.svc/>verwendet.</span><span class="sxs-lookup"><span data-stu-id="409ba-109">The examples in this topic use the sample Northwind data service located at <https://services.odata.org/Northwind/Northwind.svc/>.</span></span> <span data-ttu-id="409ba-110">Dieser Dienst wird als Teil des [OData-SDK](https://www.odata.org/wp-content/uploads/sites/21/odatasdkcodesamples.zip) bereitgestellt und bietet schreibgeschützten Zugriff auf die Beispieldatenbank Northwind.</span><span class="sxs-lookup"><span data-stu-id="409ba-110">This service is provided as part of the [OData SDK](https://www.odata.org/wp-content/uploads/sites/21/odatasdkcodesamples.zip) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="409ba-111">Wenn Schreibzugriff oder ein lokaler WCF-Datendienst gewünscht ist, können Sie die Schritte in [Schnellstart (WCF Data Services)](../data/wcf/quickstart-wcf-data-services.md) ausführen und einen lokalen OData-Dienst erstellen, der den Zugriff auf die Northwind-Datenbank ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="409ba-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](../data/wcf/quickstart-wcf-data-services.md) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="409ba-112">Ersetzen Sie bei Verwendung des Schnellstarts den lokalen URI durch den URI aus dem Beispielcode in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="409ba-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="409ba-113">Verarbeiten eines odata-Feeds mit Client Bibliotheken</span><span class="sxs-lookup"><span data-stu-id="409ba-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="409ba-114">WCF Data Services umfasst Client Bibliotheken, die es Ihnen ermöglichen, einen odata-Feed von .NET Framework und Client Anwendungen aus leichter zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="409ba-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="409ba-115">Diese Bibliotheken vereinfachen das Senden und Empfangen von HTTP-Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="409ba-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="409ba-116">Sie übersetzen außerdem die Nachrichtennutzlast in CLR-Objekte, die Entitätsdaten darstellen.</span><span class="sxs-lookup"><span data-stu-id="409ba-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="409ba-117">Die Clientbibliotheken enthalten die beiden Kernklassen <xref:System.Data.Services.Client.DataServiceContext> und <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="409ba-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="409ba-118">Diese Klassen ermöglichen es Ihnen, einen Datendienst abzufragen und dann die zurückgegebenen Entitätsdaten als CLR-Objekte zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="409ba-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="409ba-119">In diesem Abschnitt werden zwei Ansätze zum Erstellen von Aktivitäten mit Clientbibliotheken vorgestellt.</span><span class="sxs-lookup"><span data-stu-id="409ba-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="409ba-120">Hinzufügen eines Dienst Verweises zum WCF-Datendienst</span><span class="sxs-lookup"><span data-stu-id="409ba-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="409ba-121">Zum Generieren der Northwind-Client Bibliotheken können Sie das Dialogfeld **Dienstverweis hinzufügen** in Visual Studio 2012 verwenden, um einen Verweis auf den Northwind-odata-Dienst hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="409ba-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Screenshot, der das Dialogfeld "Dienstverweis hinzufügen" anzeigt.](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="409ba-123">Beachten Sie Folgendes: Vom Dienst werden keine Dienstvorgänge verfügbar gemacht, und die Liste **Dienste** enthält Elemente, die die Entitäten darstellen, die vom Northwind-Datendienst verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="409ba-124">Beim Hinzufügen des Dienstverweises werden Klassen für diese Entitäten generiert, die im Clientcode verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="409ba-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="409ba-125">In den Beispielen in diesem Thema werden diese Klassen und die `NorthwindEntities` -Klasse für die Abfragen verwendet.</span><span class="sxs-lookup"><span data-stu-id="409ba-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="409ba-126">Weitere Informationen finden Sie unter [Erstellen der Datendienst-Client Bibliothek (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="409ba-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="409ba-127">Verwenden von asynchronen Methoden</span><span class="sxs-lookup"><span data-stu-id="409ba-127">Using asynchronous methods</span></span>

<span data-ttu-id="409ba-128">Es wird empfohlen, asynchron auf WCF Data Services zuzugreifen, um mögliche Latenzprobleme beim Zugriff auf Ressourcen über das Internet zu umgehen.</span><span class="sxs-lookup"><span data-stu-id="409ba-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="409ba-129">Die WCF Data Services-Client Bibliotheken enthalten asynchrone Methoden zum Aufrufen von Abfragen, und Windows Workflow Foundation (WF) stellt die <xref:System.Activities.AsyncCodeActivity>-Klasse zum Erstellen von asynchronen Aktivitäten bereit.</span><span class="sxs-lookup"><span data-stu-id="409ba-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="409ba-130"><xref:System.Activities.AsyncCodeActivity> abgeleitete Aktivitäten können so geschrieben werden, dass Sie .NET Framework Klassen, die asynchrone Methoden aufweisen, nutzen können, oder der Code, der asynchron ausgeführt werden soll, in eine Methode eingefügt und mithilfe eines Delegaten aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="409ba-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="409ba-131">Dieser Abschnitt enthält zwei Beispiele einer von <xref:System.Activities.AsyncCodeActivity> abgeleiteten Aktivität, von denen eine die asynchronen Methoden der Clientbibliotheken von WCF Data Services und die andere einen Delegaten verwendet.</span><span class="sxs-lookup"><span data-stu-id="409ba-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="409ba-132">Weitere Informationen finden Sie unter [asynchrone Vorgänge (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) und [Erstellen von asynchronen Aktivitäten](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="409ba-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="409ba-133">Verwenden von asynchronen Methoden für Client Bibliotheken</span><span class="sxs-lookup"><span data-stu-id="409ba-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="409ba-134">Die <xref:System.Data.Services.Client.DataServiceQuery%601> -Klasse stellt die <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> - und die <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> -Methode zum asynchronen Abfragen eines OData-Diensts bereit.</span><span class="sxs-lookup"><span data-stu-id="409ba-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="409ba-135">Diese Methoden können von der <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> - und der <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> -Überschreibung einer von <xref:System.Activities.AsyncCodeActivity> abgeleiteten Klasse aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="409ba-136">Wenn die Überschreibung für <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> abgeschlossen wird, kann der Workflow in den Leerlauf übergehen (nicht jedoch beibehalten werden), und wenn die asynchrone Arbeit abgeschlossen ist, wird <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> von der Laufzeit aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="409ba-137">Im folgenden Beispiel wird eine `OrdersByCustomer` -Aktivität definiert, die über zwei Eingabeargumente verfügt.</span><span class="sxs-lookup"><span data-stu-id="409ba-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="409ba-138">Das `CustomerId` -Argument stellt den Kunden dar, der angibt, welche Aufträge zurückgegeben werden sollen, und das `ServiceUri` -Argument stellt den URI des OData-Diensts dar, der abgefragt werden soll.</span><span class="sxs-lookup"><span data-stu-id="409ba-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="409ba-139">Da diese Aktivität von `AsyncCodeActivity<IEnumerable<Order>>` abgeleitet ist, ist auch ein <xref:System.Activities.Activity%601.Result%2A> -Ausgabeargument vorhanden, mit dem die Ergebnisse der Abfrage zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="409ba-140">Mit der <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> -Überschreibung wird eine LINQ-Abfrage erstellt, die alle Aufträge des angegebenen Kunden auswählt.</span><span class="sxs-lookup"><span data-stu-id="409ba-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="409ba-141">Diese Abfrage wird als <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> des übergebenen <xref:System.Activities.AsyncCodeActivityContext>angegeben. Anschließend wird die <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> -Methode der Abfrage aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="409ba-142">Beachten Sie, dass Rückruf und Zustand, die an <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> der Abfrage übergeben werden, dem Rückruf bzw. Zustand entsprechen, die an die <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> -Methode der Aktivität übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="409ba-143">Nachdem die Ausführung der Abfrage abgeschlossen ist, wird die <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> -Methode der Aktivität aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="409ba-144">Die Abfrage wird vom <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>abgerufen, und anschließend wird die <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> -Methode der Abfrage aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="409ba-145">Von dieser Methode wird ein <xref:System.Collections.Generic.IEnumerable%601> des angegebenen Entitätstyps zurückgegeben, hier: `Order`.</span><span class="sxs-lookup"><span data-stu-id="409ba-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="409ba-146">Da `IEnumerable<Order>` der generische Typ der <xref:System.Activities.AsyncCodeActivity%601>ist, wird das <xref:System.Collections.IEnumerable> als <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> der Aktivität festgelegt.</span><span class="sxs-lookup"><span data-stu-id="409ba-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="409ba-147">Im folgenden Beispiel wird von der `OrdersByCustomer` -Aktivität eine Liste mit Aufträgen für den angegebenen Kunden abgerufen, und von einer <xref:System.Activities.Statements.ForEach%601> -Aktivität werden die zurückgegebenen Bestellungen aufgelistet und die jeweiligen Daten in die Konsole geschrieben.</span><span class="sxs-lookup"><span data-stu-id="409ba-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="409ba-148">Beim Aufrufen des Workflows werden die folgenden Daten in die Konsole geschrieben:</span><span class="sxs-lookup"><span data-stu-id="409ba-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="409ba-149">Wenn keine Verbindung zum OData-Server hergestellt werden kann, wird eine Ausnahme ähnlich der folgenden angezeigt:</span><span class="sxs-lookup"><span data-stu-id="409ba-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="409ba-150">Unbehandelte Ausnahme: System.InvalidOperationException: Fehler beim Verarbeiten dieser Anforderung.</span><span class="sxs-lookup"><span data-stu-id="409ba-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="409ba-151">---> System.Net.WebException: Die Verbindung mit dem Remoteserver kann nicht hergestellt werden. ---> System.Net.Sockets.SocketException: Ein Verbindungsversuch ist fehlgeschlagen, da die Gegenstelle nach einer bestimmten Zeitspanne nicht richtig reagiert hat, oder die hergestellte Verbindung war fehlerhaft, da der verbundene Host nicht reagiert hat.</span><span class="sxs-lookup"><span data-stu-id="409ba-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="409ba-152">Eine weitere Verarbeitung der von der Abfrage zurückgegebenen Daten kann ggf. in der <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> -Überschreibung der Aktivität erfolgen.</span><span class="sxs-lookup"><span data-stu-id="409ba-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="409ba-153"><xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> und <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> werden mit dem Workflowthread aufgerufen, und Code in den Überschreibungen wird nicht asynchron ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="409ba-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="409ba-154">Wenn die zusätzliche Verarbeitung umfangreich oder langwierig ist, oder wenn die Abfrageergebnisse seitenweise angezeigt werden, kann es empfehlenswert sein, den Ansatz im nächsten Abschnitt zu berücksichtigen. Dabei wird ein Delegat zur Ausführung der Abfrage sowie für weitere asynchrone Verarbeitungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="409ba-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="409ba-155">Verwenden eines Delegaten</span><span class="sxs-lookup"><span data-stu-id="409ba-155">Using a delegate</span></span>

<span data-ttu-id="409ba-156">Zusätzlich zum Aufrufen der asynchronen Methode einer .NET Framework Klasse kann eine <xref:System.Activities.AsyncCodeActivity>basierte Aktivität auch die asynchrone Logik in einer ihrer Methoden definieren.</span><span class="sxs-lookup"><span data-stu-id="409ba-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="409ba-157">Diese Methode wird mit einem Delegaten in der <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> -Überschreibung der Aktivität angegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="409ba-158">Nach dem Abschluss der Methode wird die <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> -Überschreibung der Methode von der Laufzeit aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="409ba-159">Beim Aufrufen eines OData-Diensts aus einem Workflow kann diese Methode zum Abfragen des Diensts verwendet werden und weitere Verarbeitungsmöglichkeiten bieten.</span><span class="sxs-lookup"><span data-stu-id="409ba-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="409ba-160">Im folgenden Beispiel wird eine `ListCustomers` -Aktivität definiert.</span><span class="sxs-lookup"><span data-stu-id="409ba-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="409ba-161">Mit dieser Aktivität wird der Beispieldatendienst Northwind abgefragt und eine `List<Customer>` mit allen Kunden in der Northwind-Datenbank zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="409ba-162">Der asynchrone Vorgang wird von der `GetCustomers` -Methode ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="409ba-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="409ba-163">Mit dieser Methode wird der Dienst für alle Kunden abgefragt, und das Ergebnis wird in eine `List<Customer>`kopiert.</span><span class="sxs-lookup"><span data-stu-id="409ba-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="409ba-164">Im Anschluss wird überprüft, ob die Ergebnisse seitenweise angegeben sind.</span><span class="sxs-lookup"><span data-stu-id="409ba-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="409ba-165">Wenn dies der Fall ist, wird die nachfolgende Ergebnisseite vom Dienst abgefragt, die Ergebnisse werden der Liste hinzugefügt, und der Vorgang wird fortgesetzt, bis alle Daten abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="409ba-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="409ba-166">Weitere Informationen zum Paging in WCF Data Services finden Sie unter Gewusst wie: Laden von Auslagerungs [Ergebnissen (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="409ba-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="409ba-167">Sobald alle Kunden hinzugefügt wurden, wird die Liste zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="409ba-168">Die `GetCustomers` -Methode wird in der <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> -Überschreibung der Aktivität angegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="409ba-169">Da die Methode über einen Rückgabewert verfügt, wird eine `Func<string, List<Customer>>` erstellt, um die Methode anzugeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="409ba-170">Wenn die Methode, mit der der asynchrone Vorgang ausgeführt wird, nicht über einen Rückgabewert verfügt, wird eine <xref:System.Action> anstelle einer <xref:System.Func%601> verwendet.</span><span class="sxs-lookup"><span data-stu-id="409ba-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="409ba-171">Beispiele zum Erstellen eines asynchronen Beispiels mit beiden Ansätzen finden Sie unter [Erstellen von asynchronen Aktivitäten](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="409ba-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="409ba-172">Diese <xref:System.Func%601> wird dem <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> zugewiesen, und anschließend wird `BeginInvoke` aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="409ba-173">Da die aufzurufende Methode nicht auf die Argumentumgebung der Aktivität zugreifen kann, wird der Wert des `ServiceUri` -Arguments als erster Parameter zusammen mit dem Rückruf und dem Zustand übergeben, die in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>übergeben wurden.</span><span class="sxs-lookup"><span data-stu-id="409ba-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="409ba-174">Beim Abschluss von `GetCustomers` wird <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>von der Laufzeit aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="409ba-175">Mit dem Code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> wird der Delegat vom <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>abgerufen, `EndInvoke`wird aufgerufen, und das Ergebnis (die Liste der Kunden, die von der `GetCustomers` -Methode zurückgegeben wurde) wird zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="409ba-176">Im folgenden Beispiel wird von der `ListCustomers` -Aktivität eine Liste mit Kunden abgerufen. Die <xref:System.Activities.Statements.ForEach%601> -Aktivität durchläuft die Kunden und schreibt den Namen des Unternehmens und den Ansprechpartner für jeden Kunden in die Konsole.</span><span class="sxs-lookup"><span data-stu-id="409ba-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="409ba-177">Beim Aufrufen des Workflows werden die folgenden Daten in die Konsole geschrieben.</span><span class="sxs-lookup"><span data-stu-id="409ba-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="409ba-178">Da von dieser Abfrage zahlreiche Kunden zurückgegeben werden, wird an dieser Stelle nur ein Teil der Ausgabe angezeigt.</span><span class="sxs-lookup"><span data-stu-id="409ba-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="409ba-179">Verarbeiten eines odata-Feeds ohne Verwendung der Client Bibliotheken</span><span class="sxs-lookup"><span data-stu-id="409ba-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="409ba-180">OData macht Daten als Ressourcen verfügbar, die durch URIs adressierbar sind.</span><span class="sxs-lookup"><span data-stu-id="409ba-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="409ba-181">Diese URIs werden bei der Verwendung von Clientbibliotheken für Sie erstellt, eine Verwendung von Clientbibliotheken ist jedoch nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="409ba-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="409ba-182">Der Zugriff auf OData-Dienste ist auch direkt und ohne Clientbibliotheken möglich.</span><span class="sxs-lookup"><span data-stu-id="409ba-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="409ba-183">Wenn Sie keine Clientbibliotheken verwenden, werden der Speicherort des Diensts sowie die gewünschten Daten durch den URI angegeben, und die Ergebnisse werden in der Antwort auf die HTTP-Anforderung zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="409ba-184">Die Rohdaten können anschließend nach Bedarf verarbeitet oder geändert werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="409ba-185">Eine Möglichkeit, die Ergebnisse einer OData-Abfrage abzurufen, besteht in der Verwendung der <xref:System.Net.WebClient> -Klasse.</span><span class="sxs-lookup"><span data-stu-id="409ba-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="409ba-186">In diesem Beispiel wird der Name des Ansprechpartners für den Kunden abgerufen, der durch Schlüssel ALFKI dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="409ba-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="409ba-187">Wenn dieser Code ausgeführt wird, wird die folgende Ausgabe in der Konsole angezeigt:</span><span class="sxs-lookup"><span data-stu-id="409ba-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="409ba-188">Der Code aus diesem Beispiel kann in einem Workflow in die <xref:System.Activities.CodeActivity.Execute%2A>-Überschreibung einer <xref:System.Activities.CodeActivity>-basierten benutzerdefinierten Aktivität eingebunden werden. Dieselbe Funktionalität kann jedoch auch mit der <xref:System.Activities.Expressions.InvokeMethod%601>-Aktivität bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="409ba-189">Mit der <xref:System.Activities.Expressions.InvokeMethod%601> -Aktivität können Workflowautoren statische Methoden und Instanzmethoden von Klassen aufrufen. Außerdem verfügen sie damit über eine Möglichkeit, die angegebene Methode asynchron aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="409ba-190">Im folgenden Beispiel wird eine <xref:System.Activities.Expressions.InvokeMethod%601> -Aktivität konfiguriert, um die <xref:System.Net.WebClient.DownloadString%2A> -Methode der <xref:System.Net.WebClient> -Klasse aufzurufen und eine Liste mit Kunden zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="409ba-191">Mit<xref:System.Activities.Expressions.InvokeMethod%601> können Sie statische Methoden und Instanzenmethoden von Klassen aufrufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="409ba-192">Da <xref:System.Net.WebClient.DownloadString%2A> eine Instanzmethode der <xref:System.Net.WebClient> -Klasse ist, wird eine neue Instanz der <xref:System.Net.WebClient> -Klasse für <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>angegeben.</span><span class="sxs-lookup"><span data-stu-id="409ba-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="409ba-193">`DownloadString` wird als <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>angegeben, der URI, der die Abfrage enthält, wird in der <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> -Auflistung angegeben, und der Rückgabewert wird dem <xref:System.Activities.Activity%601.Result%2A> -Wert zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="409ba-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="409ba-194">Der <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> -Wert wird auf `true`festgelegt, d. h., die Methode wird hinsichtlich des Workflows asynchron aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="409ba-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="409ba-195">Im folgenden Beispiel wird ein Workflow erstellt, in dem der Beispieldatendienst Northwind mit der <xref:System.Activities.Expressions.InvokeMethod%601> -Aktivität abgefragt wird, um eine Liste der Aufträge für einen bestimmten Kunden zurückzugeben und die zurückgegebenen Daten in die Konsole zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="409ba-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="409ba-196">Wenn dieser Workflow aufgerufen wird, wird die folgende Ausgabe in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="409ba-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="409ba-197">Da von dieser Abfrage zahlreiche Aufträge zurückgegeben werden, wird an dieser Stelle nur ein Teil der Ausgabe angezeigt.</span><span class="sxs-lookup"><span data-stu-id="409ba-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="409ba-198">Dieses Beispiel enthält eine Methode, die Workflowanwendungsautoren verwenden können, um die Rohdaten zu nutzen, die von einem OData-Dienst zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="409ba-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="409ba-199">Weitere Informationen zum Zugreifen auf WCF Data Services mithilfe von URIs finden Sie unter [zugreifen auf Datendienst Ressourcen (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) und [odata: URI-Konventionen](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="409ba-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>
