---
title: 'Vorgehensweise: Abfragen von nicht persistenten Instanzen'
ms.date: 03/30/2017
ms.assetid: 294019b1-c1a7-4b81-a14f-b47c106cd723
ms.openlocfilehash: 87b29ce6a5858872929cea4408d0d7bcc1b378d1
ms.sourcegitcommit: 9b1ac36b6c80176fd4e20eb5bfcbd9d56c3264cf
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/28/2019
ms.locfileid: "67425317"
---
# <a name="how-to-query-for-non-persisted-instances"></a><span data-ttu-id="15fbf-102">Vorgehensweise: Abfragen von nicht persistenten Instanzen</span><span class="sxs-lookup"><span data-stu-id="15fbf-102">How to: Query for Non-persisted Instances</span></span>

<span data-ttu-id="15fbf-103">Wenn eine neue Dienstinstanz erstellt wird und für den Dienst das SQL-Workflowinstanzspeicher-Verhalten definiert ist, erstellt der Diensthost einen ersten Eintrag für diese Dienstinstanz im Instanzspeicher.</span><span class="sxs-lookup"><span data-stu-id="15fbf-103">When a new instance of a service is created and the service has the SQL Workflow Instance Store behavior defined, the service host creates a initial entry for that service instance in the instance store.</span></span> <span data-ttu-id="15fbf-104">Bei der ersten permanenten Speicherung der Dienstinstanz speichert das SQL-Workflowinstanzspeicher-Verhalten den aktuellen Instanzstatus zusammen mit weiteren Daten, die zur Aktivierung, Wiederherstellung und Steuerung erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="15fbf-104">Subsequently when the service instance persists for the first time, the SQL Workflow Instance Store behavior stores the current instance state together with additional data that is required for activation, recovery, and control.</span></span>

<span data-ttu-id="15fbf-105">Wenn eine Instanz nach dem Erstellen des ersten Eintrags nicht permanent gespeichert wird, ist der Status der Instanz "nicht permanent".</span><span class="sxs-lookup"><span data-stu-id="15fbf-105">If an instance is not persisted after the initial entry for the instance is created, the service instance is said to be in the non-persisted state.</span></span> <span data-ttu-id="15fbf-106">Alle permanent gespeicherten Dienstinstanzen können abgefragt und gesteuert werden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-106">All the persisted service instances can be queried and controlled.</span></span> <span data-ttu-id="15fbf-107">Nicht permanente Dienstinstanzen können weder abgefragt noch gesteuert werden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-107">Non-persisted service instances can neither be queried nor controlled.</span></span> <span data-ttu-id="15fbf-108">Wenn eine nicht permanente Instanz aufgrund einer nicht behandelten Ausnahme angehalten wird, kann diese abgefragt, jedoch nicht gesteuert werden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-108">If a non-persisted instance is suspended due to an unhandled exception it can be queried but not controlled.</span></span>

<span data-ttu-id="15fbf-109">Permanente Dienstinstanzen, die noch nicht persistent gespeichert wurden, behalten in den folgenden Szenarios den Status "nicht persistent":</span><span class="sxs-lookup"><span data-stu-id="15fbf-109">Durable service instances that are not yet persisted remain in a non-persisted state in the following scenarios:</span></span>

- <span data-ttu-id="15fbf-110">Der Diensthost stürzt ab, bevor die Instanz zum ersten Mal persistent gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="15fbf-110">The service host crashes before the instance persisted for the first time.</span></span> <span data-ttu-id="15fbf-111">Der ursprüngliche Eintrag für die Instanz verbleibt im Instanzspeicher.</span><span class="sxs-lookup"><span data-stu-id="15fbf-111">The initial entry for the instance remains in the instance store.</span></span> <span data-ttu-id="15fbf-112">Die Instanz ist nicht wiederherstellbar.</span><span class="sxs-lookup"><span data-stu-id="15fbf-112">The instance is not recoverable.</span></span> <span data-ttu-id="15fbf-113">Bei Empfang einer korrelierten Meldung wird die Instanz erneut aktiviert.</span><span class="sxs-lookup"><span data-stu-id="15fbf-113">If a correlated message arrives, the instance becomes active again.</span></span>

- <span data-ttu-id="15fbf-114">Es tritt eine nicht behandelte Ausnahme auf, bevor die Instanz zum ersten Mal persistent gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="15fbf-114">The instance experiences an unhandled exception before it persisted for the first time.</span></span> <span data-ttu-id="15fbf-115">Die folgenden Szenarios treten auf:</span><span class="sxs-lookup"><span data-stu-id="15fbf-115">The following scenarios arise</span></span>

  - <span data-ttu-id="15fbf-116">Wenn der Wert des der **UnhandledExceptionAction** -Eigenschaftensatz auf **verwerfen**, die dienstbereitstellungsinformationen in den Instanzspeicher geschrieben, und die Instanz wird aus dem Arbeitsspeicher entladen.</span><span class="sxs-lookup"><span data-stu-id="15fbf-116">If the value of the **UnhandledExceptionAction** property is set to **Abandon**, the service deployment information is written to the instance store and the instance is unloaded from memory.</span></span> <span data-ttu-id="15fbf-117">Die Instanz verbleibt in der Persistenzdatenbank im nicht persistenten Status.</span><span class="sxs-lookup"><span data-stu-id="15fbf-117">The instance remains in non-persisted state in the persistence database.</span></span>

  - <span data-ttu-id="15fbf-118">Wenn der Wert des der **UnhandledExceptionAction** -Eigenschaftensatz auf **AbandonAndSuspend**, die dienstbereitstellungsinformationen in die Persistenzdatenbank geschrieben, und der Instanzstatus nastaven NA hodnotu  **Angehalten**.</span><span class="sxs-lookup"><span data-stu-id="15fbf-118">If the value of the **UnhandledExceptionAction** property is set to **AbandonAndSuspend**, the service deployment information is written to the persistence database and the instance state is set to **Suspended**.</span></span> <span data-ttu-id="15fbf-119">Die Instanz kann nicht fortgesetzt, abgebrochen oder beendet werden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-119">The instance cannot be resumed, canceled, or terminated.</span></span> <span data-ttu-id="15fbf-120">Der Diensthost kann die Instanz nicht laden, da die Instanz noch nicht persistent gespeichert wurde, d. h. der Datenbankeintrag für die Instanz ist noch nicht abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="15fbf-120">The service host cannot load the instance because the instance hasn't persisted yet and, hence the database entry for the instance is not complete.</span></span>

  - <span data-ttu-id="15fbf-121">Wenn der Wert des der **UnhandledExceptionAction** -Eigenschaftensatz auf **Abbrechen** oder **Terminate**, wird die dienstbereitstellungsinformationen in den Instanzspeicher geschrieben und die Instanzstatus nastaven NA hodnotu **abgeschlossen**.</span><span class="sxs-lookup"><span data-stu-id="15fbf-121">If the value of the **UnhandledExceptionAction** property is set to **Cancel** or **Terminate**, the service deployment information is written to the instance store and the instance state is set to **Completed**.</span></span>

<span data-ttu-id="15fbf-122">Die folgenden Abschnitte enthalten Beispielabfragen zur Suche von nicht persistenten Instanzen in der SQL-Persistenzdatenbank und zum Löschen dieser Instanzen aus der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="15fbf-122">The following sections provide sample queries to find non-persisted instances in the SQL persistence database and to delete these instances from the database.</span></span>

## <a name="to-find-all-instances-not-persisted-yet"></a><span data-ttu-id="15fbf-123">So suchen Sie nach allen noch nicht persistenten Instanzen</span><span class="sxs-lookup"><span data-stu-id="15fbf-123">To find all instances not persisted yet</span></span>

<span data-ttu-id="15fbf-124">Die folgende SQL-Abfrage gibt die ID und den Erstellungszeitpunkt für alle Instanzen zurück, die noch nicht persistent in der Persistenzdatenbank gespeichert wurden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-124">The following SQL query returns the ID and creation time for all instances that are not persisted in to the persistence database yet.</span></span>

```sql
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0;
```

## <a name="to-find-all-instances-not-persisted-yet-and-also-not-loaded"></a><span data-ttu-id="15fbf-125">So suchen Sie nach allen noch nicht persistenten und nicht geladenen Instanzen</span><span class="sxs-lookup"><span data-stu-id="15fbf-125">To find all instances not persisted yet and also not loaded</span></span>
 <span data-ttu-id="15fbf-126">Die folgende SQL-Abfrage gibt die ID und den Erstellungszeitpunkt für alle Instanzen zurück, die nicht persistent gespeichert und auch nicht geladen wurden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-126">The following SQL query returns ID and creation time for all instances that are not persisted and also are not loaded.</span></span>

```sql
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and CurrentMachine is NULL;
```

## <a name="to-find-all-suspended-instances-not-persisted-yet"></a><span data-ttu-id="15fbf-127">So suchen Sie nach allen angehaltenen noch nicht persistenten Instanzen</span><span class="sxs-lookup"><span data-stu-id="15fbf-127">To find all suspended instances not persisted yet</span></span>

<span data-ttu-id="15fbf-128">Die folgende SQL-Abfrage gibt die ID, den Erstellungszeitpunkt, den Unterbrechungsgrund und den Namen der Unterbrechungsausnahme für alle Instanzen an, die nicht persistent sind und angehalten wurden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-128">The following SQL query returns ID, creation time, suspension reason, and suspension exception name for all instances that are not persisted and also in a suspended state.</span></span>

```sql
select InstanceId, CreationTime, SuspensionReason, SuspensionExceptionName from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and IsSuspended = 1;
```

## <a name="to-delete-non-persisted-instances-from-the-persistence-database"></a><span data-ttu-id="15fbf-129">So löschen Sie nicht persistente Instanzen aus der Persistenzdatenbank</span><span class="sxs-lookup"><span data-stu-id="15fbf-129">To delete non-persisted instances from the persistence database</span></span>

<span data-ttu-id="15fbf-130">Es wird empfohlen, den Instanzspeicher in regelmäßigen Abständen auf nicht persistente Instanzen zu überprüfen und diese aus dem Instanzspeicher zu entfernen, wenn Sie sicher sind, dass die Instanz keine korrelierte Meldung empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="15fbf-130">You should periodically check the instance store for non-persisted instances and remove instances from the instance store if you are sure that the instance will not receive a correlated message.</span></span> <span data-ttu-id="15fbf-131">Beispiel: Wenn eine Instanz sich bereits mehrere Monate in der Datenbank befindet und Sie wissen, dass der Workflow in der Regel eine Lebensdauer von einigen Tagen hat, können Sie sicher annehmen, dass es sich um eine nicht initialisierte Instanz handelt, die abgestürzt ist.</span><span class="sxs-lookup"><span data-stu-id="15fbf-131">For example, if the instance has been in the database for several months and you know that the workflow typically has a lifetime of a few days, it would be safe to assume that this is an uninitialized instance that had crashed.</span></span>

<span data-ttu-id="15fbf-132">Im Allgemeinen ist es sicher, nicht persistente Instanzen zu löschen, die nicht angehalten oder geladen wurden.</span><span class="sxs-lookup"><span data-stu-id="15fbf-132">In general, it is safe to delete non-persisted instances that are not suspended or not loaded.</span></span> <span data-ttu-id="15fbf-133">Sie sollten nicht löschen **alle** nicht persistenter Instanzen, da diese Instanz Instanzen enthält, die gerade erstellt haben, aber nicht noch gespeichert.</span><span class="sxs-lookup"><span data-stu-id="15fbf-133">You should not delete **all** the non-persisted instances because this instance set includes instances that are just created but are not persisted yet.</span></span> <span data-ttu-id="15fbf-134">Löschen Sie nur nicht persistente Instanzen, die nicht mehr verwendet werden können, da beim Laden der Instanz durch den Workflowdiensthost oder durch die Instanz selbst eine Ausnahme ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="15fbf-134">You should only delete non-persisted instances that are left over because the workflow service host that had the instance loaded caused an exception or the instance itself caused an exception.</span></span>

> [!WARNING]
> <span data-ttu-id="15fbf-135">Durch das Löschen nicht persistenter Instanzen aus dem Instanzspeicher wird weniger Speicher belegt und die Leistung von Speichervorgängen möglicherweise verbessert.</span><span class="sxs-lookup"><span data-stu-id="15fbf-135">Deleting non-persisted instances from the instance store decreases the size of the store and may improve the performance of store operations.</span></span>
