---
title: Datenablaufverfolgung in ADO.NET
ms.date: 03/30/2017
ms.assetid: a6a752a5-d2a9-4335-a382-b58690ccb79f
ms.openlocfilehash: be82500920ce9d5f8bc7ee979cf8ec5006f4f12b
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/25/2019
ms.locfileid: "75347798"
---
# <a name="data-tracing-in-adonet"></a><span data-ttu-id="d9da7-102">Datenablaufverfolgung in ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d9da7-102">Data Tracing in ADO.NET</span></span>

<span data-ttu-id="d9da7-103">ADO.net bietet integrierte Funktionen für die Datenablauf Verfolgung, die von den .NET-Datenanbietern für SQL Server, Oracle, OLE DB und ODBC sowie die ADO.net-<xref:System.Data.DataSet>und die SQL Server Netzwerkprotokolle unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="d9da7-103">ADO.NET features built-in data tracing functionality that is supported by the .NET data providers for SQL Server, Oracle, OLE DB and ODBC, as well as the ADO.NET <xref:System.Data.DataSet>, and the SQL Server network protocols.</span></span>

<span data-ttu-id="d9da7-104">Die Ablaufverfolgung von Aufrufen der Datenzugriffs-API kann bei der Diagnose der folgenden Probleme helfen:</span><span class="sxs-lookup"><span data-stu-id="d9da7-104">Tracing data access API calls can help diagnose the following problems:</span></span>

- <span data-ttu-id="d9da7-105">Fehlende Schemaübereinstimmung zwischen Clientprogramm und Datenbank.</span><span class="sxs-lookup"><span data-stu-id="d9da7-105">Schema mismatch between client program and the database.</span></span>

- <span data-ttu-id="d9da7-106">Nicht verfügbare Datenbank oder Probleme mit der Netzwerkbibliothek.</span><span class="sxs-lookup"><span data-stu-id="d9da7-106">Database unavailability or network library problems.</span></span>

- <span data-ttu-id="d9da7-107">Fehlerhafte SQL-Anweisungen (sowohl hart codiert als auch von einer Anwendung generiert).</span><span class="sxs-lookup"><span data-stu-id="d9da7-107">Incorrect SQL whether hard coded or generated by an application.</span></span>

- <span data-ttu-id="d9da7-108">Fehlerhafte Programmierlogik.</span><span class="sxs-lookup"><span data-stu-id="d9da7-108">Incorrect programming logic.</span></span>

- <span data-ttu-id="d9da7-109">Probleme, die sich aus der Interaktion mehrerer ADO.NET-Komponenten oder aus der Interaktion zwischen ADO.NET und Ihren eigenen Komponenten ergeben.</span><span class="sxs-lookup"><span data-stu-id="d9da7-109">Issues resulting from the interaction between multiple ADO.NET components or between ADO.NET and your own components.</span></span>

<span data-ttu-id="d9da7-110">Zur Unterstützung verschiedener Ablaufverfolgungstechnologien ist die Ablaufverfolgung erweiterbar, sodass Entwickler eine Ablaufverfolgung für Probleme auf jeder Ebene des Anwendungsstapels ausführen können.</span><span class="sxs-lookup"><span data-stu-id="d9da7-110">To support different trace technologies, tracing is extensible, so a developer can trace a problem at any level of the application stack.</span></span> <span data-ttu-id="d9da7-111">Obwohl die Ablaufverfolgung nicht auf ADO.NET beschränkt ist, nutzen Microsoft-Anbieter die Vorteile generalisierter Ablaufverfolgungs- und Instrumentierungs-APIs.</span><span class="sxs-lookup"><span data-stu-id="d9da7-111">Although tracing is not an ADO.NET-only feature, Microsoft providers take advantage of generalized tracing and instrumentation APIs.</span></span>

<span data-ttu-id="d9da7-112">Weitere Informationen zum Festlegen und Konfigurieren der verwalteten Ablauf Verfolgung in ADO.net finden Sie unter [Tracing Data Access](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="d9da7-112">For more information about setting and configuring managed tracing in ADO.NET, see [Tracing Data Access](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span></span>

## <a name="accessing-diagnostic-information-in-the-extended-events-log"></a><span data-ttu-id="d9da7-113">Zugriff auf Diagnoseinformationen im Protokoll für erweiterte Ereignisse</span><span class="sxs-lookup"><span data-stu-id="d9da7-113">Accessing Diagnostic Information in the Extended Events Log</span></span>

<span data-ttu-id="d9da7-114">In der .NET Framework Datenanbieter für SQL Server wurde die Datenzugriffs-Ablauf Verfolgung ([Datenzugriffs](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))-Ablauf Verfolgung) aktualisiert, um das korrelieren von Client Ereignissen mit Diagnoseinformationen (z. b. Verbindungsfehlern) aus dem konnektivitätsringpuffer des Servers und den Informationen zur Anwendungsleistung im Protokoll für erweiterte Ereignisse zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="d9da7-114">In the .NET Framework Data Provider for SQL Server, data access tracing ([Data Access Tracing](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) has been updated to make it easier to correlate client events with diagnostic information, such as connection failures, from the server's connectivity ring buffer and application performance information in the extended events log.</span></span> <span data-ttu-id="d9da7-115">Informationen dazu, wie Sie das Protokoll für erweiterte Ereignisse lesen, finden Sie unter [View Event Session Data](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span><span class="sxs-lookup"><span data-stu-id="d9da7-115">For information about reading the extended events log, see [View Event Session Data](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span></span>

<span data-ttu-id="d9da7-116">Für Verbindungsvorgänge sendet ADO.NET eine Clientverbindungs-ID.</span><span class="sxs-lookup"><span data-stu-id="d9da7-116">For connection operations, ADO.NET will send a client connection ID.</span></span> <span data-ttu-id="d9da7-117">Wenn die Verbindung nicht hergestellt werden kann, können Sie auf den konnektivitätsringpuffer zugreifen ([Problembehandlung bei der Konnektivität in SQL Server 2008 mit dem konnektivitätsringpuffer](https://blogs.msdn.microsoft.com/sql_protocols/2008/05/20/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer/)) und das `ClientConnectionID` Feld Suchen und Diagnoseinformationen zum Verbindungsfehler abrufen.</span><span class="sxs-lookup"><span data-stu-id="d9da7-117">If the connection fails, you can access the connectivity ring buffer ([Connectivity troubleshooting in SQL Server 2008 with the Connectivity Ring Buffer](https://blogs.msdn.microsoft.com/sql_protocols/2008/05/20/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer/)) and find the `ClientConnectionID` field and get diagnostic information about the connection failure.</span></span> <span data-ttu-id="d9da7-118">Clientverbindungs-IDs werden nur im Ringpuffer protokolliert, wenn ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="d9da7-118">Client connection IDs are logged in the ring buffer only if an error occurs.</span></span> <span data-ttu-id="d9da7-119">(Wenn eine Verbindung nicht hergestellt werden kann, bevor das Paket für die Vorab Anmeldung gesendet wird, wird keine Clientverbindungs-ID generiert.) Die Clientverbindungs-ID ist eine 16-Byte-GUID.</span><span class="sxs-lookup"><span data-stu-id="d9da7-119">(If a connection fails before sending the prelogin packet, a client connection ID will not be generated.) The client connection ID is a 16-byte GUID.</span></span> <span data-ttu-id="d9da7-120">Sie finden die Clientverbindungs-ID auch in der Zielausgabe für erweiterte Ereignisse, wenn die `client_connection_id`-Aktion den Ereignissen in einer Sitzung für erweiterte Ereignisse hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="d9da7-120">You can also find the client connection ID in the extended events target output, if the `client_connection_id` action is added to events in an extended events session.</span></span> <span data-ttu-id="d9da7-121">Sie können die Ablaufverfolgung für den Datenzugriff aktivieren, den Verbindungsbefehl erneut ausführen und das `ClientConnectionID`-Feld in der Datenzugriffs-Ablaufverfolgung beobachten, wenn Sie weitere Diagnoseinformationen zum Clienttreiber benötigen.</span><span class="sxs-lookup"><span data-stu-id="d9da7-121">You can enable data access tracing and rerun the connection command and observe the `ClientConnectionID` field in the data access trace, if you need further client driver diagnostic assistance.</span></span>

<span data-ttu-id="d9da7-122">Sie können die Clientverbindungs-ID programmgesteuert abrufen, indem Sie die `SqlConnection.ClientConnectionID`-Eigenschaft verwenden.</span><span class="sxs-lookup"><span data-stu-id="d9da7-122">You can get the client connection ID programmatically by using the `SqlConnection.ClientConnectionID` property.</span></span>

<span data-ttu-id="d9da7-123">`ClientConnectionID` ist für ein <xref:System.Data.SqlClient.SqlConnection>-Objekt verfügbar, das erfolgreich eine Verbindung herstellt.</span><span class="sxs-lookup"><span data-stu-id="d9da7-123">The `ClientConnectionID` is available for a <xref:System.Data.SqlClient.SqlConnection> object that successfully establishes  a connection.</span></span> <span data-ttu-id="d9da7-124">Wenn ein Verbindungsfehler auftritt, ist `ClientConnectionID` u. U. über `SqlException.ToString` verfügbar.</span><span class="sxs-lookup"><span data-stu-id="d9da7-124">If a connection attempt fails, `ClientConnectionID` may be available via `SqlException.ToString`.</span></span>

<span data-ttu-id="d9da7-125">ADO.NET sendet zudem eine threadspezifische Aktivitäts-ID.</span><span class="sxs-lookup"><span data-stu-id="d9da7-125">ADO.NET also sends a thread-specific activity ID.</span></span> <span data-ttu-id="d9da7-126">Die Aktivitäts-ID wird in den Sitzungen für erweiterte Ereignisse aufgezeichnet, wenn die Sitzungen mit aktivierter TRACK_CAUSALITY Option gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="d9da7-126">The activity ID is captured in the extended events sessions if the sessions are started with the TRACK_CAUSALITY option enabled.</span></span> <span data-ttu-id="d9da7-127">Bei Leistungsproblemen mit einer aktiven Verbindung können Sie die Aktivitäts-ID aus der Datenzugriffs-Ablaufverfolgung des Clients (`ActivityID`-Feld) abrufen und die Aktivitäts-ID in der Ausgabe der erweiterten Ereignisse suchen.</span><span class="sxs-lookup"><span data-stu-id="d9da7-127">For performance issues with an active connection, you can get the activity ID from the client's data access trace (`ActivityID` field) and then locate the activity ID in the extended events output.</span></span> <span data-ttu-id="d9da7-128">Die Aktivitäts-ID in erweiterten Ereignissen ist eine 16-Byte-GUID (entspricht nicht der GUID für die Clientverbindungs-ID), an die eine 4-Byte-Sequenznummer angehängt ist.</span><span class="sxs-lookup"><span data-stu-id="d9da7-128">The activity ID in extended events is a 16-byte GUID (not the same as the GUID for the client connection ID) appended with a four-byte sequence number.</span></span> <span data-ttu-id="d9da7-129">Die Sequenznummer stellt die Reihenfolge einer Anforderung innerhalb eines Threads dar und gibt die relative Reihenfolge der Batch- und RPC-Anweisungen für den Thread an.</span><span class="sxs-lookup"><span data-stu-id="d9da7-129">The sequence number represents the order of a request within a thread and indicates the relative ordering of batch and RPC statements for the thread.</span></span> <span data-ttu-id="d9da7-130">`ActivityID` wird derzeit optional für SQL-Batchanweisungen und RPC-Anforderungen gesendet, wenn die Ablaufverfolgung für den Datenzugriff aktiviert ist und das 18. Bit im Konfigurationswort der Datenzugriffs-Ablaufverfolgung ON lautet.</span><span class="sxs-lookup"><span data-stu-id="d9da7-130">The `ActivityID` is currently optionally sent for SQL batch statements and RPC requests when data access tracing is enabled on and the 18th bit in the data access tracing configuration word is turned ON.</span></span>

<span data-ttu-id="d9da7-131">Im folgenden Beispiel wird Transact-SQL verwendet, um eine Sitzung für erweiterte Ereignisse zu starten, die in einem Ringpuffer gespeichert wird, und die von einem Client in RPC-und Batch-Vorgängen gesendete Aktivitäts-ID aufzeichnen.</span><span class="sxs-lookup"><span data-stu-id="d9da7-131">The following is a sample that uses Transact-SQL to start an extended events session that will be stored in a ring buffer and will record the activity ID sent from a client on RPC and batch operations.</span></span>

```sql
create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)
```

## <a name="see-also"></a><span data-ttu-id="d9da7-132">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="d9da7-132">See also</span></span>

- [<span data-ttu-id="d9da7-133">Netzwerkablaufverfolgung in .NET Framework</span><span class="sxs-lookup"><span data-stu-id="d9da7-133">Network Tracing in the .NET Framework</span></span>](../../network-programming/network-tracing.md)
- [<span data-ttu-id="d9da7-134">Ablaufverfolgung und Instrumentieren von Anwendungen</span><span class="sxs-lookup"><span data-stu-id="d9da7-134">Tracing and Instrumenting Applications</span></span>](../../debug-trace-profile/tracing-and-instrumenting-applications.md)
- [<span data-ttu-id="d9da7-135">Übersicht über ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d9da7-135">ADO.NET Overview</span></span>](ado-net-overview.md)
