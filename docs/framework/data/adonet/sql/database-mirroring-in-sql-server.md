---
title: Datenbankspiegelungen in SQL Server
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: b18c67f5573d375fe0872d76d69a1f0aafa7e7f6
ms.sourcegitcommit: ad800f019ac976cb669e635fb0ea49db740e6890
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/29/2019
ms.locfileid: "73040437"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="71206-102">Datenbankspiegelungen in SQL Server</span><span class="sxs-lookup"><span data-stu-id="71206-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="71206-103">Mithilfe der Datenbankspiegelung in SQL Server können Sie eine Kopie, oder auch ein Spiegelbild, einer SQL Server-Datenbank auf einem Standbyserver speichern.</span><span class="sxs-lookup"><span data-stu-id="71206-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="71206-104">Durch das Spiegeln wird sichergestellt, dass jederzeit zwei separate Kopien der Daten vorhanden sind. Dies gewährleistet Hochverfügbarkeit und vollständige Datenredundanz.</span><span class="sxs-lookup"><span data-stu-id="71206-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="71206-105">Der .NET-Datenanbieter für SQL Server stellt implizite Unterstützung für die Datenbankspiegelung bereit. Daher muss der Entwickler keine weiteren Schritte ausführen oder Code programmieren, nachdem die Spiegelung für eine SQL Server-Datenbank konfiguriert wurde.</span><span class="sxs-lookup"><span data-stu-id="71206-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="71206-106">Außerdem unterstützt das <xref:System.Data.SqlClient.SqlConnection>-Objekt einen expliziten Verbindungsmodus, über den der Name eines Failover-Partnerservers im <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> angegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="71206-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="71206-107">Die folgende vereinfachte Ereignissequenz tritt bei einem <xref:System.Data.SqlClient.SqlConnection>-Objekt ein, das eine Datenbank zum Ziel hat, welche für die Spiegelung konfiguriert wurde:</span><span class="sxs-lookup"><span data-stu-id="71206-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="71206-108">Die Clientanwendung stellt mit Erfolg eine Verbindung mit der Prinzipaldatenbank her, und der Server sendet den Namen des Partnerservers zurück, der dann auf dem Client zwischengespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="71206-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="71206-109">Wenn der Server mit der Prinzipaldatenbank ausfällt oder die Konnektivität unterbrochen wird, gehen die Verbindung und der Transaktionsstatus verloren.</span><span class="sxs-lookup"><span data-stu-id="71206-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="71206-110">Die Clientanwendung versucht, erneut eine Verbindung mit der Prinzipaldatenbank herzustellen, und hat damit keinen Erfolg.</span><span class="sxs-lookup"><span data-stu-id="71206-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="71206-111">Die Clientanwendung versucht daraufhin transparent, eine Verbindung mit der Spiegeldatenbank auf dem Partnerserver herzustellen.</span><span class="sxs-lookup"><span data-stu-id="71206-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="71206-112">Wenn dieser Vorgang erfolgreich ausgeführt werden kann, wird die Verbindung zur Spiegeldatenbank umgeleitet, die daraufhin zur neuen Prinzipaldatenbank wird.</span><span class="sxs-lookup"><span data-stu-id="71206-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="71206-113">Angeben des Failoverpartners in der Verbindungszeichenfolge</span><span class="sxs-lookup"><span data-stu-id="71206-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="71206-114">Wenn Sie den Namen eines Failover-Partnerservers in der Verbindungszeichenfolge angeben, versucht der Client transparent, eine Verbindung mit dem Failover-Partnerserver herzustellen, wenn die Prinzipaldatenbank beim ersten Verbindungsversuch der Clientanwendung nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="71206-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```csharp
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="71206-115">Wenn Sie den Namen des Failover-Partnerservers nicht angeben und die Prinzipaldatenbank nicht verfügbar ist, wenn die Clientanwendung eine Verbindung herstellt, wird ein <xref:System.Data.SqlClient.SqlException>-Objekt ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="71206-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="71206-116">Wenn ein <xref:System.Data.SqlClient.SqlConnection> erfolgreich geöffnet wird, wird der Failover-Partnername vom Server zurückgegeben. Er hat Vorrang vor allen in der Verbindungszeichenfolge angegebenen Werten.</span><span class="sxs-lookup"><span data-stu-id="71206-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="71206-117">Sie müssen den Namen des Anfangskatalogs oder der Angangsdatenbank explizit in der Verbindungszeichenfolge für Szenarien mit Datenbankspiegelung angeben.</span><span class="sxs-lookup"><span data-stu-id="71206-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="71206-118">Wenn der Client Failoverinformationen zu einer Verbindung empfängt, für die nicht explizit ein Anfangskatalog oder eine Anfangsdatenbank angegeben wurde, werden die Failoverinformationen nicht zwischengespeichert, und die Anwendung versucht auch nicht, bei einem Ausfall des Prinzipalservers einen Failover durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="71206-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="71206-119">Wenn eine Verbindungszeichenfolge über einen Wert für den Failoverpartner, nicht jedoch über einen Wert für den Anfangskatalog oder die Anfangsdatenbank verfügt, wird eine `InvalidArgumentException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="71206-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="71206-120">Abrufen des Namens für den aktuellen Server</span><span class="sxs-lookup"><span data-stu-id="71206-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="71206-121">Im Fall eines Failovers können Sie den Namen des Servers, mit dem tatsächlich die aktuelle Verbindung besteht, mit der <xref:System.Data.SqlClient.SqlConnection.DataSource%2A>-Eigenschaft eines <xref:System.Data.SqlClient.SqlConnection>-Objekts abrufen.</span><span class="sxs-lookup"><span data-stu-id="71206-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="71206-122">Das folgende Codefragment ruft den Namen des aktiven Servers ab. Dabei wird davon ausgegangen, dass die Verbindungsvariable auf eine geöffnete <xref:System.Data.SqlClient.SqlConnection> verweist.</span><span class="sxs-lookup"><span data-stu-id="71206-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="71206-123">Wenn ein failoverereignis auftritt und die Verbindung zum Spiegel Server gewechselt wird, wird die **DataSource** -Eigenschaft aktualisiert, um den Spiegelungs Namen widerzuspiegeln.</span><span class="sxs-lookup"><span data-stu-id="71206-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="71206-124">Spiegelungsverhalten bei "SqlClient"</span><span class="sxs-lookup"><span data-stu-id="71206-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="71206-125">Der Client versucht stets, eine Verbindung mit dem aktuellen Prinzipalserver herzustellen.</span><span class="sxs-lookup"><span data-stu-id="71206-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="71206-126">Wenn keine Verbindung hergestellt werden kann, wechselt er zum Failover-Partner.</span><span class="sxs-lookup"><span data-stu-id="71206-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="71206-127">Wenn die Spiegeldatenbank auf dem Partnerserver bereits auf die Prinzipalrolle heraufgestuft wurde, kann die Verbindung hergestellt werden. Die neue Prinzipal-Spiegel-Zuordnung wird an den Client gesendet und für die Lebensdauer der aufrufenden <xref:System.AppDomain> zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="71206-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="71206-128">Er wird nicht in einem permanenten Speicher gespeichert und ist nicht für nachfolgende Verbindungen in einer anderen Anwendungs **Domäne** oder einem anderen Prozess verfügbar.</span><span class="sxs-lookup"><span data-stu-id="71206-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="71206-129">Es ist jedoch für nachfolgende Verbindungen innerhalb derselben **AppDomain**verfügbar.</span><span class="sxs-lookup"><span data-stu-id="71206-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="71206-130">Beachten Sie, dass eine andere **AppDomain** oder ein anderer Prozess, der auf demselben oder einem anderen Computer ausgeführt wird, immer über einen Pool von Verbindungen verfügt und diese Verbindungen nicht zurückgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="71206-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="71206-131">Wenn die primäre Datenbank ausfällt, tritt für jeden Prozess oder jede **AppDomain** ein Fehler auf, und der Pool wird automatisch gelöscht.</span><span class="sxs-lookup"><span data-stu-id="71206-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="71206-132">Die Unterstützung für Spiegelung auf dem Server wird pro Datenbank konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="71206-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="71206-133">Wenn für andere Datenbanken, die nicht zur Prinzipal-Spiegel-Konfiguration gehören, Datenbearbeitungsvorgänge ausgeführt werden (entweder durch Verwendung mehrteiliger Namen oder durch Ändern der aktuellen Datenbank), werden die Änderungen an diesen anderen Datenbanken bei einem Ausfall nicht übernommen.</span><span class="sxs-lookup"><span data-stu-id="71206-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="71206-134">Beim Ändern von Daten in einer Datenbank, die nicht gespiegelt ist, wird kein Fehler erzeugt.</span><span class="sxs-lookup"><span data-stu-id="71206-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="71206-135">Entwickler müssen die möglichen Auswirkungen solcher Vorgänge überprüfen.</span><span class="sxs-lookup"><span data-stu-id="71206-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="71206-136">Ressourcen zur Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="71206-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="71206-137">Eine konzeptionelle Dokumentation und Informationen zum Konfigurieren, bereitstellen und Verwalten der Spiegelung finden Sie in den folgenden Ressourcen in SQL Server Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="71206-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="71206-138">Ressource</span><span class="sxs-lookup"><span data-stu-id="71206-138">Resource</span></span>|<span data-ttu-id="71206-139">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="71206-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="71206-140">Daten Bank Spiegelung</span><span class="sxs-lookup"><span data-stu-id="71206-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="71206-141">Beschreibt, wie die Spiegelung in SQL Server eingerichtet und konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="71206-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="71206-142">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="71206-142">See also</span></span>

- [<span data-ttu-id="71206-143">Übersicht über ADO.NET</span><span class="sxs-lookup"><span data-stu-id="71206-143">ADO.NET Overview</span></span>](../ado-net-overview.md)
