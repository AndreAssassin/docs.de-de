---
title: Eintragen von Ressourcen als Teilnehmer an einer Transaktion
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
ms.openlocfilehash: 98872bd3ccddb1696b37eace0e28156cdbe002dc
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/23/2019
ms.locfileid: "61793730"
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="a07bf-102">Eintragen von Ressourcen als Teilnehmer an einer Transaktion</span><span class="sxs-lookup"><span data-stu-id="a07bf-102">Enlisting Resources as Participants in a Transaction</span></span>

<span data-ttu-id="a07bf-103">Jede an einer Transaktion teilnehmende Ressource wird von einem Ressourcen-Manager (RM) verwaltet, dessen Aktionen von einem Transaktions-Manager (TM) koordiniert werden.</span><span class="sxs-lookup"><span data-stu-id="a07bf-103">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="a07bf-104">Die Koordination erfolgt anhand von Benachrichtigungen, die Abonnenten übermittelt werden, die sich über den TM in eine Transaktion eingetragen haben.</span><span class="sxs-lookup"><span data-stu-id="a07bf-104">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>

<span data-ttu-id="a07bf-105">In diesem Thema wird beschrieben, wie eine oder mehrere Ressourcen in eine Transaktion eingetragen werden können. Zudem werden die verschiedenen Eintragungstypen erläutert.</span><span class="sxs-lookup"><span data-stu-id="a07bf-105">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="a07bf-106">Die [Commit einer Transaktion Einphasen-oder Mehrphasencommits](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) Thema behandelt, wie ein Transaktionscommit unter eingetragenen Ressourcen koordiniert werden kann.</span><span class="sxs-lookup"><span data-stu-id="a07bf-106">The [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>

## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="a07bf-107">Eintragen von Ressourcen in eine Transaktion</span><span class="sxs-lookup"><span data-stu-id="a07bf-107">Enlisting Resources in a Transaction</span></span>

<span data-ttu-id="a07bf-108">Damit eine Ressource an einer Transaktion teilnehmen kann, muss sie sich in die Transaktion eintragen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-108">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="a07bf-109">Die <xref:System.Transactions.Transaction> Klasse definiert einen Satz von Methoden, deren Namen beginnen mit **eintragen** , die diese Funktionalität bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-109">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="a07bf-110">Die verschiedenen **eintragen** Methoden entsprechen, um die verschiedenen Typen von der Eintragung, die ein RM verfügen kann.</span><span class="sxs-lookup"><span data-stu-id="a07bf-110">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="a07bf-111">Die <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methoden werden für flüchtige Ressourcen und die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode wird für dauerhafte Ressourcen verwendet.</span><span class="sxs-lookup"><span data-stu-id="a07bf-111">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="a07bf-112">Die Dauerhaftigkeit (oder im Gegensatz dazu die Flüchtigkeit) eines Ressourcen-Managers leitet sich davon ab, ob der Ressourcen-Manager die Wiederherstellung nach einem Fehler unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a07bf-112">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="a07bf-113">Wenn ein RM die Wiederherstellung nach einem Fehler unterstützt, legt er Daten während Phase 1 (Vorbereitung) in einem permanenten Speicher ab, damit er sich im Falle eines Ausfalls nach der Wiederherstellung erneut in die Transaktion eintragen und entsprechend den Benachrichtigungen des TM geeignete Aktionen ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="a07bf-113">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="a07bf-114">Im Allgemeinen verwalten flüchtige RMs flüchtige Ressourcen wie beispielsweise eine speicherinterne Datenstruktur (z. B. eine speicherinterne Transaktions-Hashtabelle), und dauerhafte RMs verwalten Ressourcen, die über einen beständigeren Sicherungsspeicher verfügen (z. B. eine Datenbank, deren Sicherungsspeicher ein Datenträger ist).</span><span class="sxs-lookup"><span data-stu-id="a07bf-114">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>

<span data-ttu-id="a07bf-115">Nachdem auf der Grundlage der Dauerhaftigkeit Ihrer Ressource entschieden wurde, ob die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode oder die <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methode verwendet wird, sollten Sie Ihre Ressource für die Teilnahme an einem Zweiphasencommit (2PC) eintragen, indem Sie die <xref:System.Transactions.IEnlistmentNotification>-Schnittstelle für Ihren RM implementieren.</span><span class="sxs-lookup"><span data-stu-id="a07bf-115">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="a07bf-116">Weitere Informationen über 2PC finden Sie unter [Commit einer Transaktion Einphasen-oder Mehrphasencommits](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="a07bf-116">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>

<span data-ttu-id="a07bf-117">Ein einzelner Teilnehmer kann sich für mehrere dieser Protokolle eintragen, indem er <xref:System.Transactions.Transaction.EnlistDurable%2A> und <xref:System.Transactions.Transaction.EnlistVolatile%2A> mehrmals aufruft.</span><span class="sxs-lookup"><span data-stu-id="a07bf-117">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>

### <a name="durable-enlistment"></a><span data-ttu-id="a07bf-118">Dauerhafte Eintragung</span><span class="sxs-lookup"><span data-stu-id="a07bf-118">Durable Enlistment</span></span>

<span data-ttu-id="a07bf-119">Die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methoden werden verwendet, um einen RM zur Teilnahme an der Transaktion als dauerhafte Ressource einzutragen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-119">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="a07bf-120">Wenn ein dauerhafter RM während einer Transaktion durch eine Unterbrechung ausfällt, wird erwartet, dass er eine Wiederherstellung durchführen kann, sobald er wieder online ist, indem er sich erneut (mithilfe der <xref:System.Transactions.TransactionManager.Reenlist%2A>-Methode) in alle Transaktionen einträgt, an denen er teilgenommen und für die er die Phase 2 nicht abgeschlossen hat. Nach Beendigung des Wiederherstellungsprozesses muss er zudem <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-120">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="a07bf-121">Weitere Informationen zur Wiederherstellung finden Sie unter [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="a07bf-121">For more information on recovery, see [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md).</span></span>

<span data-ttu-id="a07bf-122">Die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methoden nehmen alle ein <xref:System.Guid>-Objekt als ersten Parameter an.</span><span class="sxs-lookup"><span data-stu-id="a07bf-122">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="a07bf-123"><xref:System.Guid> wird vom TM dazu verwendet, eine dauerhafte Eintragung einem bestimmten RM zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-123">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="a07bf-124">Daher ist es zwingend erforderlich, dass ein RM dieselbe <xref:System.Guid>-Identifikation verwendet (selbst bei einem Neustart mit mehreren RMs), da ansonsten die Wiederherstellung fehlschlagen kann.</span><span class="sxs-lookup"><span data-stu-id="a07bf-124">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>

<span data-ttu-id="a07bf-125">Der zweite Parameter der <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode ist ein Verweis auf das Objekt, das der RM implementiert, um Transaktionsbenachrichtigungen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a07bf-125">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="a07bf-126">Die von Ihnen verwendete Überladung informiert den TM darüber, ob Ihr RM die Einphasencommit(SPC)-Optimierung unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a07bf-126">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="a07bf-127">Meist empfiehlt sich die Implementierung der <xref:System.Transactions.IEnlistmentNotification>-Schnittstelle, um an einem Zweiphasencommit (2PC) teilzunehmen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-127">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="a07bf-128">Wenn Sie den Commitvorgang jedoch optimieren möchten, können Sie die <xref:System.Transactions.ISinglePhaseNotification>-Schnittstelle für das Einphasencommit implementieren.</span><span class="sxs-lookup"><span data-stu-id="a07bf-128">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="a07bf-129">Weitere Informationen über den SPC finden Sie unter [Commit einer Transaktion Einphasen-oder Mehrphasencommits](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) und [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="a07bf-129">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>

<span data-ttu-id="a07bf-130">Der dritte Parameter ist eine <xref:System.Transactions.EnlistmentOptions>-Enumeration, deren Wert <xref:System.Transactions.EnlistmentOptions.None> oder <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired> sein kann.</span><span class="sxs-lookup"><span data-stu-id="a07bf-130">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="a07bf-131">Wenn der Wert auf <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired> festgelegt ist, kann die Eintragung bei Erhalt der Vorbereitungsbenachrichtigung vom TM weitere RMs aufnehmen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-131">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="a07bf-132">Jedoch sollten Sie bedenken, dass für diesen Eintragungstyp keine Einphasencommit-Optimierung möglich ist.</span><span class="sxs-lookup"><span data-stu-id="a07bf-132">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>

### <a name="volatile-enlistment"></a><span data-ttu-id="a07bf-133">Flüchtige Eintragung</span><span class="sxs-lookup"><span data-stu-id="a07bf-133">Volatile Enlistment</span></span>

<span data-ttu-id="a07bf-134">Teilnehmer, die flüchtige Ressourcen, wie z. B. einen Cache, verwalten, sollten sich mithilfe der <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methoden eintragen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-134">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="a07bf-135">Diese Objekte sind möglicherweise nicht in der Lage, nach einem Systemausfall das Ergebnis einer Transaktion zu empfangen oder den Status der Transaktion, an der sie teilnehmen, wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-135">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>

<span data-ttu-id="a07bf-136">Wie zuvor bereits ausgeführt, nimmt ein RM eine flüchtige Eintragung vor, wenn er eine speicherinterne, flüchtige Ressource verwaltet.</span><span class="sxs-lookup"><span data-stu-id="a07bf-136">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="a07bf-137">Einer der Vorteile der Verwendung von <xref:System.Transactions.Transaction.EnlistVolatile%2A> besteht darin, dass keine unnötige Eskalation der Transaktion erzwungen wird.</span><span class="sxs-lookup"><span data-stu-id="a07bf-137">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="a07bf-138">Weitere Informationen zu transaktionseskalation finden Sie unter [Eskalation der Transaktionsverwaltung](../../../../docs/framework/data/transactions/transaction-management-escalation.md) Thema.</span><span class="sxs-lookup"><span data-stu-id="a07bf-138">For more information on transaction escalation, see [Transaction Management Escalation](../../../../docs/framework/data/transactions/transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="a07bf-139">Volatilität Eintragung impliziert einerseits einen Unterschied in der Behandlung der eintragungs durch den Transaktions-Manager sowie die Erwartungen des Ressourcen-Managers vom Transaktions-Manager.</span><span class="sxs-lookup"><span data-stu-id="a07bf-139">Enlisting volatility implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="a07bf-140">Das liegt daran, dass ein flüchtiger Ressourcen-Manager keine Wiederherstellung durchführt.</span><span class="sxs-lookup"><span data-stu-id="a07bf-140">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="a07bf-141">Die <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Methoden verwenden den <xref:System.Guid>-Parameter nicht, weil ein flüchtiger Ressourcen-Manager keine Wiederherstellung durchführt und die <xref:System.Transactions.TransactionManager.Reenlist%2A>-Methode nicht aufruft, die <xref:System.Guid> benötigt.</span><span class="sxs-lookup"><span data-stu-id="a07bf-141">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>

<span data-ttu-id="a07bf-142">Wie bei den dauerhaften Eintragungen erkennt der TM an der Überladungsmethode, die Sie zur Eintragung verwenden, ob Ihr RM die Einphasencommit-Optimierung unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a07bf-142">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="a07bf-143">Da ein flüchtiger Ressourcen-Manager keine Wiederherstellung durchführen kann, werden während der Vorbereitungsphase für eine flüchtige Eintragung keine Wiederherstellungsinformationen geschrieben.</span><span class="sxs-lookup"><span data-stu-id="a07bf-143">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="a07bf-144">Daher führt der Aufruf der <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A>-Methode zu <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="a07bf-144">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>

<span data-ttu-id="a07bf-145">Im folgenden Beispiel wird die Eintragung mithilfe der <xref:System.Transactions.Transaction.EnlistVolatile%2A>-Schnittstelle eines solchen Objekts als Teilnehmer in einer Transaktion veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="a07bf-145">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>

[!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
[!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]

### <a name="optimizing-performance"></a><span data-ttu-id="a07bf-146">Optimieren der Leistung</span><span class="sxs-lookup"><span data-stu-id="a07bf-146">Optimizing Performance</span></span>

<span data-ttu-id="a07bf-147">Die <xref:System.Transactions.Transaction>-Klasse stellt die <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A>-Methode auch bereit, um eine Erweiterbare Einphaseneintragung (PSPE) vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="a07bf-147">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="a07bf-148">Dadurch wird es einem dauerhaften RM ermöglicht, eine Transaktion zu hosten und zu "besitzen", die später bei Bedarf eskaliert werden kann, um von MSDTC verwaltet zu werden.</span><span class="sxs-lookup"><span data-stu-id="a07bf-148">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="a07bf-149">Weitere Informationen hierzu finden Sie unter [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="a07bf-149">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="a07bf-150">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="a07bf-150">See also</span></span>

- [<span data-ttu-id="a07bf-151">Optimierung mit Einphasencommit und heraufstufbarer Einphasenbenachrichtigung</span><span class="sxs-lookup"><span data-stu-id="a07bf-151">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)
- [<span data-ttu-id="a07bf-152">Ausführen eines Einphasen- oder Mehrphasencommits für eine Transaktion</span><span class="sxs-lookup"><span data-stu-id="a07bf-152">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](../../../../docs/framework/data/transactions/committing-a-transaction-in-single-phase-and-multi-phase.md)
