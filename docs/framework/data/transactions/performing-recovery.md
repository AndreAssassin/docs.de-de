---
title: Durchführen einer Wiederherstellung
ms.date: 03/30/2017
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
ms.openlocfilehash: 149ac6b6162893de830f59b3d18008d8298eab56
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/23/2019
ms.locfileid: "61793613"
---
# <a name="performing-recovery"></a><span data-ttu-id="d0fc0-102">Durchführen einer Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="d0fc0-102">Performing Recovery</span></span>
<span data-ttu-id="d0fc0-103">Ein Ressourcen-Manager erleichtert das Auflösen dauerhafter Eintragungen in einer Transaktion, indem er den Transaktionsteilnehmer nach einem Fehler der Ressource neu einträgt.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-103">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="d0fc0-104">Der Wiederherstellungsprozess</span><span class="sxs-lookup"><span data-stu-id="d0fc0-104">The Recovery Process</span></span>  
 <span data-ttu-id="d0fc0-105">Um eine Ressource dauerhaft einzutragen (wird durch eine Implementierung der <xref:System.Transactions.IEnlistmentNotification>-Schnittstelle beschrieben), damit sie später bei Bedarf wiederhergestellt werden kann, müssen Sie die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-105">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="d0fc0-106">Darüber hinaus müssen Sie die <xref:System.Transactions.Transaction.EnlistDurable%2A>-Methode mit einem Ressourcen-Manager-Bezeichner ausstatten (<xref:System.Guid>), der dazu verwendet wird, den Teilnehmer an einer Transaktion im Falle eines Ressourcenfehlers eindeutig zu kennzeichnen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-106">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="d0fc0-107">Aus diesem Grund die <xref:System.Guid> , die dem anfänglichen eintragungsaufruf bekannt identisch sein sollte dient der *ResourceManagerIdentifier* Parameter in der <xref:System.Transactions.TransactionManager.Reenlist%2A> -Aufruf während der Wiederherstellung.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-107">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="d0fc0-108">Andernfalls wird eine <xref:System.Transactions.TransactionException>-Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-108">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="d0fc0-109">Weitere Informationen zu permanenten Eintragungen finden Sie unter [eintragen von Ressourcen als Teilnehmer an einer Transaktion](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span><span class="sxs-lookup"><span data-stu-id="d0fc0-109">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="d0fc0-110">Wenn der von Ihnen implementierte dauerhafte Ressourcen-Manager in der Vorbereitungsphase (Phase 1) des 2PC-Protokolls die <xref:System.Transactions.IEnlistmentNotification.Prepare%2A>-Benachrichtigung erhält, muss er seinen Vorbereitungsdatensatz während dieser Phase protokollieren.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-110">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="d0fc0-111">Der Datensatz muss alle notwendigen Informationen enthalten, um den Commit der Transaktion auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-111">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="d0fc0-112">Der Vorbereitungsdatensatz kann später während der Wiederherstellung zugegriffen werden, durch Abrufen der <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> Eigenschaft der *PreparingEnlistment* Rückruf.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-112">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="d0fc0-113">Die Datensatzprotokollierung muss nicht innerhalb der <xref:System.Transactions.IEnlistmentNotification.Prepare%2A>-Methode durchgeführt werden, da der RM dies mit einem Arbeitsthread erledigen kann.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-113">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="d0fc0-114">Der Wiederherstellungsprozess läuft in zwei Schritten ab:</span><span class="sxs-lookup"><span data-stu-id="d0fc0-114">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="d0fc0-115">Schritt - Erneute Eintragung</span><span class="sxs-lookup"><span data-stu-id="d0fc0-115">Step 1 - ReEnlist</span></span>  
 <span data-ttu-id="d0fc0-116">Der Ressourcen-Manager untersucht den Vorbereitungsdatensatz jeder Eintragung, die zweifelhaft ist.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-116">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="d0fc0-117">Dies geschieht durch Überprüfung der <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A>-Eigenschaft des <xref:System.Transactions.PreparingEnlistment>-Aufrufs, der in der <xref:System.Transactions.IEnlistmentNotification.Prepare%2A>-Benachrichtigung während Phase 1 an den Ressourcen-Manager übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-117">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="d0fc0-118">Für jede Eintragung, die es untersucht, ruft er <xref:System.Transactions.TransactionManager.Reenlist%2A> für den Transaktions-Manager auf.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-118">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="d0fc0-119">Diese Methode gibt eine eindeutige <xref:System.Guid> weiter, die den Ressourcen-Manager und die Informationen der Eintragung in einem Bytearray identifiziert.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-119">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="d0fc0-120">Es wird ein neues <xref:System.Transactions.Enlistment>-Objekt zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-120">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="d0fc0-121">Schlägt die erneute Eintragung mit einer Ausnahme fehl, muss der Ressourcen-Manager zu einem späteren Zeitpunkt einen neuen Versuch unternehmen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-121">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="d0fc0-122">Rufen Sie die <xref:System.Transactions.TransactionManager.Reenlist%2A>-Methode nur auf, wenn ein Ressourcen-Manager nach einem Fehler neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-122">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="d0fc0-123">Tragen Sie außerdem nur nicht aufgelöste Transaktionen erneut ein, die von einem Ressourcen-Manager während der anfänglichen Vorbereitungsphase eines Zweiphasencommits protokolliert wurden.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-123">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="d0fc0-124">Bei jedem Versuch, diese Methode zu unzulässigen Zeitpunkten aufzurufen, können falsche Ergebnisse erzeugt werden.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-124">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="d0fc0-125">Wenn ein Teilnehmer mit dieser Methode neu eingetragen wird, werden die <xref:System.Transactions.IEnlistmentNotification>-Methoden aus Phase 2, die dem Transaktionsergebnis entsprechen (d. h. <xref:System.Transactions.IEnlistmentNotification.Commit%2A>, <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> oder <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A>), aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-125">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="d0fc0-126">Schritt - Durchführen der Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="d0fc0-126">Step 2 - Completing the recovery</span></span>  
 <span data-ttu-id="d0fc0-127">Wenn alle Neueintragungen erfolgt sind, ruft der Ressourcen-Manager die <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>-Methode auf.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-127">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="d0fc0-128">Diese Methode führt die Wiederherstellung zu Ende und informiert den Transaktions-Manager darüber, dass der Ressourcen-Manager über keine weiteren zweifelhaften Transaktionen verfügt.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-128">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="d0fc0-129">Dadurch garantiert der Ressourcen-Manager, dass er die <xref:System.Transactions.TransactionManager.Reenlist%2A>-Methode nicht noch einmal aufruft.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-129">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="d0fc0-130">Ein Ressourcen-Manager braucht nicht alle zweifelhaften Transaktionen aufzulösen, bevor er Eintragungen in neue Transaktionen vornimmt.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-130">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="d0fc0-131">Der erste Schritt kann ausgeführt werden, zu einem beliebigen Zeitpunkt nach der Ressourcen-Manager eine Beziehung mit der Transaktions-Manager jedoch nach herstellt <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> war aufgerufen (Schritt 2); Schritt 1 nicht erneut ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-131">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="d0fc0-132">Schritt 2 kann mehrmals wiederholt werden, ohne das Ergebnis von Transaktionen zu beeinflussen.</span><span class="sxs-lookup"><span data-stu-id="d0fc0-132">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
