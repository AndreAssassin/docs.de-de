---
title: Migrieren von C++/CLI-Projekten in .NET Core
description: Informationen zum Portieren von C++/CLI-Projekten zu .NET Core
author: mjrousos
ms.date: 01/10/2020
ms.openlocfilehash: eb03f2a5ff42e8279fd3ebd6ee6fb6d955f6798d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 03/14/2020
ms.locfileid: "75964860"
---
# <a name="how-to-port-a-ccli-project-to-net-core"></a><span data-ttu-id="a5188-103">Portieren eines C++/CLI-Projekts zu .NET Core</span><span class="sxs-lookup"><span data-stu-id="a5188-103">How to port a C++/CLI project to .NET Core</span></span>

<span data-ttu-id="a5188-104">Ab .NET Core 3.1 und Visual Studio 2019, Version 16.4 sind [C++/CLI-Projekte](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) mit .NET Core kompatibel.</span><span class="sxs-lookup"><span data-stu-id="a5188-104">Beginning with .NET Core 3.1 and Visual Studio 2019 version 16.4, [C++/CLI projects](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) can target .NET Core.</span></span> <span data-ttu-id="a5188-105">Dadurch können Windows-Desktopanwendungen mit C++/CLI-Interopebenen zu .NET Core portiert werden.</span><span class="sxs-lookup"><span data-stu-id="a5188-105">This support makes it possible to port Windows desktop applications with C++/CLI interop layers to .NET Core.</span></span> <span data-ttu-id="a5188-106">In diesem Artikel wird beschrieben, wie Sie C++/CLI-Projekte von .NET Framework zu .NET Core 3.1 portieren können.</span><span class="sxs-lookup"><span data-stu-id="a5188-106">This article describes how to port C++/CLI projects from .NET Framework to .NET Core 3.1.</span></span>

## <a name="ccli-net-core-limitations"></a><span data-ttu-id="a5188-107">C++/CLI-Einschränkungen für .NET Core</span><span class="sxs-lookup"><span data-stu-id="a5188-107">C++/CLI .NET Core limitations</span></span>

<span data-ttu-id="a5188-108">Im Vergleich zu anderen Sprachen gibt es einige wichtige Einschränkungen beim Portieren von C++/CLI-Projekten zu .NET Core:</span><span class="sxs-lookup"><span data-stu-id="a5188-108">There are some important limitations to porting C++/CLI projects to .NET Core compared to other languages:</span></span>

* <span data-ttu-id="a5188-109">C++/CLI wird nur unter Windows für .NET Core unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a5188-109">C++/CLI support for .NET Core is Windows only.</span></span>
* <span data-ttu-id="a5188-110">C++/CLI-Projekte sind nicht mit .NET Standard kompatibel, sondern nur mit .NET Core (oder .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="a5188-110">C++/CLI projects can't target .NET Standard, only .NET Core (or .NET Framework).</span></span>
* <span data-ttu-id="a5188-111">C++/CLI-Projekte unterstützen nicht das neue SDK-Format für Projektdateien.</span><span class="sxs-lookup"><span data-stu-id="a5188-111">C++/CLI projects don't support the new SDK-style project file format.</span></span> <span data-ttu-id="a5188-112">Stattdessen wird für C++/CLI-Projekte das etablierte VCXPROJ-Dateiformat verwendet, auch wenn sie auf .NET Core ausgerichtet sind.</span><span class="sxs-lookup"><span data-stu-id="a5188-112">Instead, even when targeting .NET Core, C++/CLI projects use the existing vcxproj file format.</span></span>
* <span data-ttu-id="a5188-113">C++/CLI-Projekte können nicht mit mehreren .NET-Plattformen kompatibel sein.</span><span class="sxs-lookup"><span data-stu-id="a5188-113">C++/CLI projects can't multitarget multiple .NET platforms.</span></span> <span data-ttu-id="a5188-114">Wenn Sie ein C++/CLI-Projekt erstellen möchten, dass sowohl unter .NET Framework als auch unter .NET Core verwendet werden kann, müssen Sie separate Projektdateien verwenden.</span><span class="sxs-lookup"><span data-stu-id="a5188-114">If you need to build a C++/CLI project for both .NET Framework and .NET Core, use separate project files.</span></span>
* <span data-ttu-id="a5188-115">.Net Core unterstützt keine `-clr:pure`- oder `-clr:safe`-Kompilierung, sondern nur die neue `-clr:netcore`-Option, die `-clr` für .NET Framework entspricht.</span><span class="sxs-lookup"><span data-stu-id="a5188-115">.NET Core doesn't support `-clr:pure` or `-clr:safe` compilation, only the new `-clr:netcore` option (which is equivalent to `-clr` for .NET Framework).</span></span>

## <a name="port-a-ccli-project"></a><span data-ttu-id="a5188-116">Portieren eines C++/CLI-Projekts</span><span class="sxs-lookup"><span data-stu-id="a5188-116">Port a C++/CLI project</span></span>

<span data-ttu-id="a5188-117">Wenn Sie ein C++/CLI-Projekt zu .NET Core portieren möchten, sollten Sie die folgenden Änderungen an der VCXPROJ-Datei vornehmen.</span><span class="sxs-lookup"><span data-stu-id="a5188-117">To port a C++/CLI project to .NET Core, make the following changes to the vcxproj file.</span></span> <span data-ttu-id="a5188-118">Der Ablauf dieser Migration unterscheidet sich vom Ablauf bei anderen Projekttypen, da bei C++/CLI-Projekten keine SDK-Projektdateien verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a5188-118">These migration steps differ from the steps needed for other project types because C++/CLI projects don't use SDK-style project files.</span></span>

1. <span data-ttu-id="a5188-119">Ersetzen Sie `<CLRSupport>true</CLRSupport>`-Eigenschaften durch `<CLRSupport>NetCore</CLRSupport>`.</span><span class="sxs-lookup"><span data-stu-id="a5188-119">Replace `<CLRSupport>true</CLRSupport>` properties with `<CLRSupport>NetCore</CLRSupport>`.</span></span> <span data-ttu-id="a5188-120">Diese Eigenschaft ist häufig in konfigurationsspezifischen Eigenschaftengruppen enthalten. Deshalb müssen Sie sie möglicherweise an mehreren Stellen ersetzen.</span><span class="sxs-lookup"><span data-stu-id="a5188-120">This property is often in configuration-specific property groups, so you may need to replace it in multiple places.</span></span>
2. <span data-ttu-id="a5188-121">Ersetzen Sie `<TargetFrameworkVersion>`-Eigenschaften durch `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span><span class="sxs-lookup"><span data-stu-id="a5188-121">Replace `<TargetFrameworkVersion>` properties with `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span></span>
3. <span data-ttu-id="a5188-122">Entfernen Sie alle .NET Framework-Verweise (z. B. `<Reference Include="System" />`).</span><span class="sxs-lookup"><span data-stu-id="a5188-122">Remove any .NET Framework references (like `<Reference Include="System" />`).</span></span> <span data-ttu-id="a5188-123">Wenn `<CLRSupport>NetCore</CLRSupport>` verwendet wird, wird automatisch auf .NET Core SDK-Assemblys verwiesen.</span><span class="sxs-lookup"><span data-stu-id="a5188-123">.NET Core SDK assemblies are automatically referenced when using `<CLRSupport>NetCore</CLRSupport>`.</span></span>
4. <span data-ttu-id="a5188-124">Aktualisieren Sie ggf. die API-Verwendung in CPP-Dateien, um APIs zu entfernen, die nicht für .NET Core verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="a5188-124">Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span></span> <span data-ttu-id="a5188-125">Da es sich bei C++/CLI-Projekten in der Regel um relativ dünne Interopebenen handelt, müssen oft nur wenige Änderungen vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="a5188-125">Because C++/CLI projects tend to be fairly thin interop layers, there are often not many changes needed.</span></span> <span data-ttu-id="a5188-126">[.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) kann verwendet werden, um verwaltete Binärdateien und nicht unterstützte .NET-APIs zu ermitteln, die von C++/CLI-Binärdateien verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a5188-126">The [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can be used to identify unsupported .NET APIs used by C++/CLI binaries just as with purely managed binaries.</span></span> <span data-ttu-id="a5188-127">Im [Leitfaden zum Portieren von Bibliotheken](./libraries.md#determine-portability) finden Sie Anweisungen dazu, wie Sie die Portabilität von Code bestimmen und Projekte aktualisieren können, sodass sie mit .NET Core-APIs verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="a5188-127">Guidelines for determining code portability and updating projects to work with .NET Core APIs are available in the [library porting guidance](./libraries.md#determine-portability).</span></span>

### <a name="wpf-and-windows-forms-usage"></a><span data-ttu-id="a5188-128">Nutzung von WPF und Windows Forms</span><span class="sxs-lookup"><span data-stu-id="a5188-128">WPF and Windows Forms usage</span></span>

<span data-ttu-id="a5188-129">C++/CLI-Projekte für .NET Core können Windows Forms- und WPF-APIs verwenden.</span><span class="sxs-lookup"><span data-stu-id="a5188-129">.NET Core C++/CLI projects can use Windows Forms and WPF APIs.</span></span> <span data-ttu-id="a5188-130">Damit Sie diese Windows-Desktop-APIs verwenden können, müssen Sie explizite Frameworkverweise auf die Benutzeroberflächenbibliotheken hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a5188-130">To use these Windows desktop APIs, you need to add explicit framework references to the UI libraries.</span></span> <span data-ttu-id="a5188-131">SDK-Projekte, die Windows-Desktop-APIs verwenden, verweisen automatisch unter Verwendung des `Microsoft.NET.Sdk.WindowsDesktop` SDK auf die erforderlichen Frameworkbibliotheken.</span><span class="sxs-lookup"><span data-stu-id="a5188-131">SDK-style projects that use Windows desktop APIs reference the necessary framework libraries automatically by using the `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span></span> <span data-ttu-id="a5188-132">Da C++/CLI-Projekte nicht das SDK-Projektformat verwenden, müssen explizite Frameworkverweise hinzugefügt werden, wenn ein Projekt auf .NET Core ausgerichtet ist.</span><span class="sxs-lookup"><span data-stu-id="a5188-132">Because C++/CLI projects don't use the SDK-style project format, they need to add explicit framework references when targeting .NET Core.</span></span>

<span data-ttu-id="a5188-133">Damit Sie Windows Forms-APIs verwenden können, sollten Sie den folgenden Verweis zur VCXPROJ-Datei hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="a5188-133">To use Windows Forms APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of Windows Forms -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />
```

<span data-ttu-id="a5188-134">Damit Sie WPF-APIs verwenden können, sollten Sie den folgenden Verweis zur VCXPROJ-Datei hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="a5188-134">To use WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of WPF -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WPF" />
```

<span data-ttu-id="a5188-135">Wenn Sie sowohl Windows Forms- als auch WPF-APIs verwenden möchten, fügen Sie den folgenden Verweis zu Ihrer VCXPROJ-Datei hinzu:</span><span class="sxs-lookup"><span data-stu-id="a5188-135">To use both Windows Forms and WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference the entirety of the Windows desktop framework:
     Windows Forms, WPF, and the types that provide integration between them -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App" />
```

<span data-ttu-id="a5188-136">Derzeit ist es nicht möglich, diese Verweise mithilfe des Verweis-Managers von Visual Studio hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="a5188-136">Currently, it's not possible to add these references using Visual Studio's reference manager.</span></span> <span data-ttu-id="a5188-137">Aktualisieren Sie die Projektdatei stattdessen manuell.</span><span class="sxs-lookup"><span data-stu-id="a5188-137">Instead, update the project file manually.</span></span> <span data-ttu-id="a5188-138">Sie können dieses Update in Visual Studio durchführen, indem Sie das Projekt entladen und anschließend die Projektdatei bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="a5188-138">This update can be done in Visual Studio by unloading the project and then editing the project file.</span></span> <span data-ttu-id="a5188-139">Sie können auch einen anderen Editor verwenden, z. B. Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="a5188-139">You can also use another editor like VS Code.</span></span>

## <a name="build-without-msbuild"></a><span data-ttu-id="a5188-140">Build ohne MSBuild</span><span class="sxs-lookup"><span data-stu-id="a5188-140">Build without MSBuild</span></span>

<span data-ttu-id="a5188-141">Es ist auch möglich, C++/CLI-Projekte ohne MSBuild zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="a5188-141">It's also possible to build C++/CLI projects without using MSBuild.</span></span> <span data-ttu-id="a5188-142">Führen Sie die folgenden Schritte aus, um direkt mithilfe der Dateien *cl.exe* und *link.exe* ein C++/CLI-Projekt für .NET Core zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="a5188-142">Follow these steps to build a C++/CLI project for .NET Core directly with *cl.exe* and *link.exe*:</span></span>

1. <span data-ttu-id="a5188-143">Übergeben Sie bei der Kompilierung `-clr:netcore` an *cl.exe*.</span><span class="sxs-lookup"><span data-stu-id="a5188-143">When compiling, pass `-clr:netcore` to *cl.exe*.</span></span>
2. <span data-ttu-id="a5188-144">Verweisen Sie auf erforderliche Referenzassemblys für .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a5188-144">Reference necessary .NET Core reference assemblies.</span></span>
3. <span data-ttu-id="a5188-145">Geben Sie bei der Verknüpfung das Verzeichnis für den .NET Core-App-Host als `LibPath` an, damit die Datei *ijwhost.lib* gefunden werden kann.</span><span class="sxs-lookup"><span data-stu-id="a5188-145">When linking, provide the .NET Core app host directory as a `LibPath` (so that *ijwhost.lib* can be found).</span></span>
4. <span data-ttu-id="a5188-146">Kopieren Sie *ijwhost.dll* aus dem Verzeichnis des .NET Core-App-Hosts in das Ausgabeverzeichnis des Projekts.</span><span class="sxs-lookup"><span data-stu-id="a5188-146">Copy *ijwhost.dll* (from the .NET Core app host directory) to the project's output directory.</span></span>
5. <span data-ttu-id="a5188-147">Stellen Sie sicher, dass für die erste Komponente der Anwendung, die verwalteten Code ausführt, eine [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)-Datei vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="a5188-147">Make sure a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file exists for the first component of the application that will run managed code.</span></span> <span data-ttu-id="a5188-148">Wenn die Anwendung über einen verwalteten Einstiegspunkt verfügt, wird automatisch eine `runtime.config`-Datei erstellt und kopiert.</span><span class="sxs-lookup"><span data-stu-id="a5188-148">If the application has a managed entry point, a `runtime.config` file will be created and copied automatically.</span></span> <span data-ttu-id="a5188-149">Wenn die Anwendung allerdings über einen nativen Einstiegspunkt verfügt, müssen Sie eine `runtimeconfig.json`-Datei erstellen, damit die erste C++/CLI-Bibliothek die .NET Core-Runtime verwenden kann.</span><span class="sxs-lookup"><span data-stu-id="a5188-149">If the application has a native entry point, though, you need to create a `runtimeconfig.json` file for the first C++/CLI library to use the .NET Core runtime.</span></span>

## <a name="known-issues"></a><span data-ttu-id="a5188-150">Bekannte Probleme</span><span class="sxs-lookup"><span data-stu-id="a5188-150">Known issues</span></span>

<span data-ttu-id="a5188-151">Es gibt zwei bekannte Probleme, die bei der Arbeit mit C++/CLI-Projekten entstehen können, die auf .NET Core ausgerichtet sind.</span><span class="sxs-lookup"><span data-stu-id="a5188-151">There are a couple known issues to look out for when working with C++/CLI projects targeting .NET Core.</span></span>

* <span data-ttu-id="a5188-152">Ein WPF-Frameworkverweis in C++/CLI-Projekten für .NET Core löst derzeit einige unwesentliche Warnungen aus, weil der Import von Symbolen nicht möglich ist.</span><span class="sxs-lookup"><span data-stu-id="a5188-152">A WPF framework reference in .NET Core C++/CLI projects currently causes some extraneous warnings about being unable to import symbols.</span></span> <span data-ttu-id="a5188-153">Sie können diese Warnungen bedenkenlos ignorieren. Dieses Problem sollte bald behoben sein.</span><span class="sxs-lookup"><span data-stu-id="a5188-153">These warnings can be safely ignored and should be fixed soon.</span></span>
* <span data-ttu-id="a5188-154">Wenn die Anwendung über einen nativen Einstiegspunkt verfügt, benötigt die C++/CLI-Bibliothek, die zuerst verwalteten Code ausführt, eine [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)-Datei.</span><span class="sxs-lookup"><span data-stu-id="a5188-154">If the application has a native entry point, the C++/CLI library that first executes managed code needs a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file.</span></span> <span data-ttu-id="a5188-155">Diese Konfigurationsdatei wird verwendet, wenn die .NET Core-Runtime gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="a5188-155">This config file is used when the .NET Core runtime starts.</span></span> <span data-ttu-id="a5188-156">C++/CLI-Projekte erstellen nicht automatisch zur Buildzeit `runtimeconfig.json`-Dateien. Deshalb müssen diese Dateien manuell erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="a5188-156">C++/CLI projects don't create `runtimeconfig.json` files automatically at build time yet, so the file must be generated manually.</span></span> <span data-ttu-id="a5188-157">Wenn eine C++/CLI-Bibliothek über einen verwalteten Einstiegspunkt aufgerufen wird, benötigt die C++/CLI-Bibliothek keine `runtimeconfig.json`-Datei, weil die Einstiegspunktassembly bereits über eine verfügt, die beim Start der Runtime verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="a5188-157">If a C++/CLI library is called from a managed entry point, then the C++/CLI library doesn't need a `runtimeconfig.json` file (since the entry point assembly will have one that is used when starting the runtime).</span></span> <span data-ttu-id="a5188-158">Nachfolgend finden Sie ein Beispiel für eine `runtimeconfig.json`-Datei.</span><span class="sxs-lookup"><span data-stu-id="a5188-158">A simple sample `runtimeconfig.json` file is shown below.</span></span> <span data-ttu-id="a5188-159">Weitere Informationen finden Sie in der [Spezifikation auf GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span><span class="sxs-lookup"><span data-stu-id="a5188-159">For more information, see the [spec on GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span></span>

    ```json
    {
          "runtimeOptions": {
             "tfm": "netcoreapp3.1",
             "framework": {
                "name": "Microsoft.NETCore.App",
                "version": "3.1.0"
             }
          }
    }
    ```
